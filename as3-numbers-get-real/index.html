<!DOCTYPE html>
<html>
	

<head>
	<title>AS3 Numbers - Get Real | Mark S. Rasmussen</title>
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
	<meta charset="UTF-8" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="website" />
	<meta name="google-site-verification" content="alt7-wfK3ZujMQ4D0jYNd0yC5LGetGdqBlBmZsqQlVw" />
	<link rel="alternative" href="http://feeds.feedburner.com/Improvedk" title="Mark S. Rasmussen" type="application/atom+xml">
	<script src="/js/combined.js"></script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-2479580-1', 'improve.dk');
		ga('require', 'displayfeatures');
		ga('send', 	'pageview');
	</script>
	<link rel="stylesheet" href="/css/style.css" type="text/css" />
	<link rel="stylesheet" href="/css/print.css" type="text/css" media="print" />
</head>
	<body>
		<div id="headerline"></div>
	
		<header>
			<div class="wrapper">
				<div id="title">
					<a href="/">Mark S. Rasmussen</a> <span>improve.dk</span>
				</div>
				
				<nav>
					<ul class="normal">
						<li class="navicon"></li>
						<li><a href="/about-me/">About Me</a></li>
					</ul>
				</nav>
				
				<ul id="sharing">
					<li><a href="mailto:mark@improve.dk" id="shareat"></a></li>
					<li><a href="http://feeds.feedburner.com/Improvedk" id="rssfeed"></a></li>
					<li><a href="https://twitter.com/improvedk" id="sharetwitter"></a></li>
					<li><a href="https://github.com/improvedk" id="sharegithub"></a></li>
					<li><a href="https://www.linkedin.com/in/markrasmussen/" id="sharelinkedin"></a></li>
				</ul>

				<div class="clear"></div>
				
				<div id="naviconcontent">
					<ul class="mobile">
						<li>
							Pages
							<ul class="pages"></ul>
						</li>
						<li>
							Categories
							<ul class="categories"></ul>
						</li>
						<li>
							Archive
							<ul class="archive"></ul>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div id="mainwrapper">
			<div id="contentwrapper">
				<div id="content">
				
					<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Jun</span>
			<span class="day">12</span>
		</div>
		<div class="lower">2008</div>
	</div>

	<div class="title">
		<h1><a href="/as3-numbers-get-real/" title="AS3 Numbers - Get Real" rel="bookmark">AS3 Numbers - Get Real</a></h1>
		<div class="categories">
			
				<a href="/category/AS/Flex/Flash/">AS/Flex/Flash</a>
				
			
		</div>
		
			<div class="comments">
				<a href="#comments" title="Comment on AS3 Numbers - Get Real">Comments</a>
			</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" class="single">

		
		
			<div class="body">
			
				<p>Skilled developers are hard to come by these days, that includes Flash/AS3/Flex developers. As the product I’m working on is very much dependent on a Flash based frontend, I’ve been forced to learn &amp; work with AS3 &amp; Flex recently.</p>
<a id="more"></a>

<p>It’s a great experience, learning a new language - especially now that Silverlight is marching forward. As the old saying goes, know your enemy. Anyways, enough with the chit chatting, on with the problems.</p>
<p>Today I tried making a very simple functionality, I wanted to be able to select a number of images by making them highlight when selected, and dim out when deselected:</p>
<figure class="highlight mxml"><pre><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="tag">&lt;<span class="title">mx:Application
	xmlns:mx="http:</span>//<span class="attribute">www.adobe.com</span>/<span class="attribute">2006</span>/<span class="attribute">mxml</span>"
	<span class="attribute">layout</span>=<span class="value">"absolute"</span>&gt;</span>

	<span class="tag">&lt;<span class="title">mx:Script</span>&gt;</span>
		<span class="cdata">&lt;![CDATA[
			private function onClick():void
			{
				if(btnTest.alpha == 0.5)
					btnTest.alpha = 1;
				else
					btnTest.alpha = 0.5;
			}
		]]&gt;</span>
	<span class="tag">&lt;/<span class="title">mx:Script</span>&gt;</span>

	<span class="tag">&lt;<span class="title">mx:Button</span> <span class="attribute">id</span>=<span class="value">"btnTest"</span> <span class="attribute">click</span>=<span class="value">"onClick()"</span> <span class="attribute">label</span>=<span class="value">"Click me!"</span>/&gt;</span>

<span class="tag">&lt;/<span class="title">mx:Application</span>&gt;</span>
</pre></figure>

<p><a href="120.swf">A.swf - Demo</a></p>
<p>In this case the button is “selected” from the start (alpha = 1). When clicked, the alpha changes to half opaque (0.5), switches back to 1 when reclicked, and so forth. All working good.</p>
<p>But it’s a bit hard to differentiate between selected and non selected, so let’s change the alpha setting to 0.4 instead of 0.5:</p>
<figure class="highlight mxml"><pre><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="tag">&lt;<span class="title">mx:Application
	xmlns:mx="http:</span>//<span class="attribute">www.adobe.com</span>/<span class="attribute">2006</span>/<span class="attribute">mxml</span>"
	<span class="attribute">layout</span>=<span class="value">"absolute"</span>&gt;</span>

	<span class="tag">&lt;<span class="title">mx:Script</span>&gt;</span>
		<span class="cdata">&lt;![CDATA[
			private function onClick():void
			{
				if(btnTest.alpha == 0.4)
					btnTest.alpha = 1;
				else
					btnTest.alpha = 0.4;
			}
		]]&gt;</span>
	<span class="tag">&lt;/<span class="title">mx:Script</span>&gt;</span>

	<span class="tag">&lt;<span class="title">mx:Button</span> <span class="attribute">id</span>=<span class="value">"btnTest"</span> <span class="attribute">click</span>=<span class="value">"onClick()"</span> <span class="attribute">label</span>=<span class="value">"Click me!"</span>/&gt;</span>

<span class="tag">&lt;/<span class="title">mx:Application</span>&gt;</span>
</pre></figure>

<p><a href="121.swf">B.swf - Demo</a></p>
<p>But what’s this, now we’re only able to dim it, not reselect it. Why’s that? Nothing’s changed other than the alpha value. The problem becomes apparent if we trace out the buttons alpha value like so:</p>
<figure class="highlight mxml"><pre><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="tag">&lt;<span class="title">mx:Application
	xmlns:mx="http:</span>//<span class="attribute">www.adobe.com</span>/<span class="attribute">2006</span>/<span class="attribute">mxml</span>"
	<span class="attribute">layout</span>=<span class="value">"absolute"</span>&gt;</span>

	<span class="tag">&lt;<span class="title">mx:Script</span>&gt;</span>
		<span class="cdata">&lt;![CDATA[
			private function onClick():void
			{
				if(btnTest.alpha == 0.4)
					btnTest.alpha = 1;
				else
					btnTest.alpha = 0.4;

				mx.controls.Alert.show(btnTest.alpha.toString());
			}
		]]&gt;</span>
	<span class="tag">&lt;/<span class="title">mx:Script</span>&gt;</span>

	<span class="tag">&lt;<span class="title">mx:Button</span> <span class="attribute">id</span>=<span class="value">"btnTest"</span> <span class="attribute">click</span>=<span class="value">"onClick()"</span> <span class="attribute">label</span>=<span class="value">"Click me!"</span>/&gt;</span>

<span class="tag">&lt;/<span class="title">mx:Application</span>&gt;</span>
</pre></figure>

<p><a href="122.swf">C.swf - Demo</a></p>
<p>In case you don’t have Flash 9 installed, or are just too lazy to click the button, the resulting Alert box shows the following value: 0.3984375 - obviously not quite the 0.4 we specified.</p>
<p>Ok, let’s dumb it down a bit and do some quick testing:</p>
<figure class="highlight mxml"><pre>&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"utf-8"</span>?&gt;
&lt;mx:Application
	xmlns:mx=<span class="string">"http://www.adobe.com/2006/mxml"</span>
	layout=<span class="string">"absolute"</span>
	initialize=<span class="string">"onInitialize()"</span>&gt;

	&lt;mx:Script&gt;
		&lt;![CDATA[

			<span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">onInitialize</span><span class="params">()</span><span class="type">:void</span>
			{</span>
				<span class="comment">// true</span>
				trace(<span class="number">0.4</span> == <span class="number">0.4</span>);

				<span class="comment">// true</span>
				<span class="keyword">var</span> zeroPointFour:Number = <span class="number">0.4</span>;
				trace(zeroPointFour == <span class="number">0.4</span>);

				<span class="comment">// true</span>
				<span class="keyword">var</span> secondZeroPointFour:Number = <span class="number">0.4</span>;
				trace(zeroPointFour == secondZeroPointFour);

				<span class="comment">// false</span>
				<span class="keyword">var</span> testSprite:Sprite = <span class="keyword">new</span> Sprite();
				testSprite.alpha = <span class="number">0.4</span>;
				trace(testSprite.alpha == <span class="number">0.4</span>);

				<span class="comment">// 0.3984375</span>
				trace(testSprite.alpha);

				<span class="comment">// false - duh</span>
				trace(<span class="number">0.3984375</span> == <span class="number">0.4</span>)
			}

		]]&gt;
	&lt;/mx:Script&gt;

&lt;/mx:Application&gt;
</pre></figure>

<p>Now this is where things start getting weird. We can obviously store the value 0.4 in a number (which is a 64 bit double-precision format according to the <a href="http://en.wikipedia.org/wiki/IEEE_754" target="_blank">IEEE-754 spec</a>). Furthermore, we’re also able to compare two instances of Number with the value 0.4 and get the expected equality comparison result, true. Now, it would seem that as soon we set the alpha value on our Sprite, it’s corrupted. Sprite inherits the alpha property from <a href="http://livedocs.adobe.com/flex/2/langref/flash/display/DisplayObject.html" target="_blank">DisplayObject</a> - which obviously lists alpha as a value of type Number.</p>
<p>Why does this happen? It’s no problem storing the value 0.4 in a 64 bit double precision number:</p>
<figure class="highlight"><pre><span class="attribute">Sign</span>: <span class="string">+1</span>
<span class="attribute">Exponent</span>: <span class="string">-2</span>
<span class="attribute">Mantissa</span>: <span class="string">1.6</span>
<span class="attribute">Result</span>: <span class="string">sign x 2&lt;sup&gt;exponent&lt;/sup&gt; x mantissa =&gt; +1 x 2&lt;sup&gt;-2&lt;/sup&gt; x 1.6 = 0.4</span>
</pre></figure>

<p>It might be (and probably is) me not understanding something right. Can somebody explain to me how the Flash VM handles Numbers, and thereby, explain why this is happening? Is it perhaps not due to the VM’s handling of Numbers, but instead just a simple matter of an odd implementation of the alpha property on DisplayObject?</p>


				<div style="clear: both"></div>

				
					<div id="postsharing">
						<a href="https://twitter.com/home?status=AS3%20Numbers%20-%20Get%20Real%20http%3A%2F%2Fimprove.dk%2Fas3-numbers-get-real%2F%20via%20%40improvedk" target="_blank" class="twitter"></a>
						<a href="https://www.facebook.com/sharer.php?u=http%3A%2F%2Fimprove.dk%2Fas3-numbers-get-real%2F" target="_blank" class="facebook"></a>
						<a href="http://reddit.com/submit?url=http%3A%2F%2Fimprove.dk%2Fas3-numbers-get-real%2F&title=AS3%20Numbers%20-%20Get%20Real" target="_blank" class="reddit"></a>
						<a href="https://github.com/improvedk/improve.dk/blob/master/source/_posts/as3-numbers-get-real/as3-numbers-get-real.md" target="_blank" title="View source" class="github"></a>
					</div>

					<div id="bio">
						<div class="avatar"></div>
						<div class="wrapper">
							<div class="name">Mark S. Rasmussen</div>
							<div class="description">
								I'm the CTO at <a href="http://www.ipaper-cms.com/">iPaper</a> where I cuddle with databases, mold code and maintain the overall technical &amp; team responsibility. I'm an avid speaker at user groups &amp; conferences. I love life, motorcycles, photography and all things technical. Say hi on <a href="http://twitter.com/improvedk">Twitter</a>, write me an <a href="mailto:mark@improve.dk">email</a> or look me up on <a href="http://dk.linkedin.com/in/markrasmussen/">LinkedIn</a>.
							</div>
						</div>
						<div class="clear"></div>
					</div>
				

			</div>

		

		
			<a name="comments"></a>
<div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'improvedk';
	var disqus_identifier = 'as3-numbers-get-real';
	var disqus_url = 'http://improve.dk/as3-numbers-get-real/';

	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
		

	</div>
</article>

				</div>
			</div>

			<div id="asides">
				<div class="categories aside">
					<span class="sectiontitle">CATEGORIES</span>
					<ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/category/.NET/">.NET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/AS/Flex/Flash/">AS/Flex/Flash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Amazon Web Services/">Amazon Web Services</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Computer Science/">Computer Science</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Conferences and Presenting/">Conferences and Presenting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/IIS/">IIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Life/">Life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Miscellaneous/">Miscellaneous</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Performance/">Performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Poker/">Poker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server/">SQL Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Community/">SQL Server - Community</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Data Types/">SQL Server - Data Types</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Internals/">SQL Server - Internals</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Optimization/">SQL Server - Optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - OrcaMDF/">SQL Server - OrcaMDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Tricks/">SQL Server - Tricks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Testing/">Testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Tools of the Trade/">Tools of the Trade</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Umbraco/">Umbraco</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Visual Studio/">Visual Studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Web/">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Windbg/">Windbg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Windows/">Windows</a></li></ul>

					
				</div>

				<div class="archive aside">
					<span class="sectiontitle">ARCHIVE</span>
					<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archive/2014">2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2013">2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2012">2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2011">2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2010">2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2009">2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2008">2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2007">2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2006">2006</a></li></ul>
				</div>
			</div>

			<div class="clear"></div>
		</div>
		
		<footer>
			<div class="wrapper">Copyright &copy; 2014 Mark S. Rasmussen</div>
		</footer>

		<script type="text/javascript">
			$(function () {
				// Show mobile menu
				$("li.navicon").click(function () {
					if ($("header ul.mobile a").length == 0) {
						// Pages
						$mobilePages = $("div#naviconcontent ul.pages");
						$("header nav ul.normal > li").not(".navicon").each(function (i, el) {
							$mobilePages.append($(el).clone());
						});

						// Categories
						$mobileCategories = $("div#naviconcontent ul.categories");
						$("div#asides div.categories > ul > li").each(function (i, el) {
							$mobileCategories.append($(el).clone());
						});

						// Archive
						$mobileArchive = $("div#naviconcontent ul.archive");
						$("div#asides div.archive > ul > li").each(function (i, el) {
							$mobileArchive.append($(el).clone());
						});
					};

					$("header ul.mobile").toggle();
				});

				// Fancybox setup
				$("a.fancy").fancybox({
					hideOnContentClick: true,
					overlayShow: true
				});
			});
		</script>
	</body>
</html>