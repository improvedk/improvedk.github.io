<!DOCTYPE html>
<html>
	

<head>
	<title>Mark S. Rasmussen</title>
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
	<meta charset="UTF-8" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="website" />
	<meta name="google-site-verification" content="alt7-wfK3ZujMQ4D0jYNd0yC5LGetGdqBlBmZsqQlVw" />
	<meta content="article" property="og:type">
<meta content="Mark S. Rasmussen" property="og:title">
<meta content="http://improve.dk/page/20/" property="og:url">
<meta property="og:image">
<meta content="Mark S. Rasmussen" property="og:site_name">
<meta property="og:description">
<meta content="summary" name="twitter:card">
	<link rel="alternative" href="http://feeds.feedburner.com/Improvedk" title="Mark S. Rasmussen" type="application/atom+xml">
	<script src="/js/combined.js"></script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-2479580-1', 'improve.dk');
		ga('require', 'displayfeatures');
		ga('send', 	'pageview');
	</script>
	<link rel="stylesheet" href="/css/style.css" type="text/css" />
</head>
	<body>
		<div id="headerline"></div>
	
		<header>
			<div class="wrapper">
				<div id="title">
					<a href="/">Mark S. Rasmussen</a> <span>improve.dk</span>
				</div>
				
				<nav>
					<ul class="normal">
						<li class="navicon"></li>
						<li><a href="/about-me/">About Me</a></li>
					</ul>
				</nav>
				
				<ul id="sharing">
					<li><a href="mailto:mark@improve.dk" id="shareat"></a></li>
					<li><a href="http://feeds.feedburner.com/Improvedk" id="rssfeed"></a></li>
					<li><a href="https://twitter.com/improvedk" id="sharetwitter"></a></li>
					<li><a href="https://github.com/improvedk" id="sharegithub"></a></li>
					<li><a href="https://www.linkedin.com/in/markrasmussen/" id="sharelinkedin"></a></li>
				</ul>

				<div class="clear"></div>
				
				<div id="naviconcontent">
					<ul class="mobile">
						<li>
							Pages
							<ul class="pages"></ul>
						</li>
						<li>
							Categories
							<ul class="categories"></ul>
						</li>
						<li>
							Archive
							<ul class="archive"></ul>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div id="mainwrapper">
			<div id="contentwrapper">
				<div id="content">
				
					
	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">06</span>
		</div>
		<div class="lower">2007</div>
	</div>

	<div class="title">
		<h1><a href="/enumerating-windows/" title="Enumerating Windows Using PInvoke" rel="bookmark">Enumerating Windows Using PInvoke</a></h1>
		<div class="categories">
			
				<a href="/category/.NET/">.NET</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Until now we’ve seen how to retrieve basic properties of windows as well as how to interact with them by sending keypresses. Up until now we’ve had to find the handle by using Winspector or a similar program. This time I’ll present a way of finding the handles programmatically.</p>
<a id="more"></a>


<figure class="highlight cs"><pre><span class="keyword">using</span> System.Runtime.InteropServices;
<span class="keyword">using</span> System.Text;
<span class="keyword">using</span> System;

namespace Enumerating_windows
{
	class Program
	{
		<span class="comment">// These are two Win32 constants that we'll need, they were explained in an earlier blog.</span>
		<span class="keyword">const</span> <span class="keyword">int</span> WM_GETTEXT		= <span class="number">0x000D</span>;
		<span class="keyword">const</span> <span class="keyword">int</span> WM_GETTEXTLENGTH	= <span class="number">0x000E</span>;

		<span class="comment">// SendMessage overload.</span>
		[DllImport(<span class="string">"User32.dll"</span>)]
		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> Int32 <span class="title">SendMessage</span>(<span class="keyword">int</span> hWnd, <span class="keyword">int</span> Msg, <span class="keyword">int</span> wParam, <span class="keyword">int</span> lParam);

		<span class="comment">// SendMessage overload.</span>
		[DllImport(<span class="string">"User32.dll"</span>)]
		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> Int32 <span class="title">SendMessage</span>(<span class="keyword">int</span> hWnd, <span class="keyword">int</span> Msg, <span class="keyword">int</span> wParam, StringBuilder lParam);

		<span class="comment">// The GetClassName function takes a handle as a parameter as well as a StringBuilder</span>
		<span class="comment">// and the max capacity of the StringBuilder as parameters. It'll return the windows</span>
		<span class="comment">// class name by filling up the StringBuilder - though not any longer than the max capacity.</span>
		<span class="comment">// If the class is longer than the max capacity it will simply be cropped. Having a larger</span>
		<span class="comment">// capacity than necessary is simply a matter of performance.</span>
		[DllImport(<span class="string">"User32.Dll"</span>)]
		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">GetClassName</span>(<span class="keyword">int</span> hWnd, StringBuilder s, <span class="keyword">int</span> nMaxCount);

		<span class="comment">// The EnumWindows function will enumerate all windows in the system. Each window will cause</span>
		<span class="comment">// the PCallBack callback function to be called.</span>
		[DllImport(<span class="string">"user32.Dll"</span>)]
		<span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">bool</span> EnumWindows(PCallBack callback, <span class="keyword">int</span> lParam);

		<span class="comment">// This is the delegate that sets the signature for the callback function of the EnumWindows function.</span>
		<span class="keyword">private</span> <span class="keyword">delegate</span> <span class="keyword">bool</span> <span class="title">PCallBack</span>(<span class="keyword">int</span> hwnd, <span class="keyword">int</span> lParam);

		<span class="keyword">static</span> <span class="keyword">void</span> Main(<span class="keyword">string</span>[] args)
		{
			<span class="comment">// All we'll do is to invoke the EnumWindows function, passing in a new delegate specifying the EnumWindowsCallback</span>
			<span class="comment">// function as the callback function. The lParam parameter can be used to send in an integer that will be passed</span>
			<span class="comment">// onto the callback function unmodified. It's optional, but it may be useful in some situations.</span>
			EnumWindows(<span class="keyword">new</span> PCallBack(EnumWindowsCallback), <span class="number">0</span>);

			Console.Read();
		}

		<span class="comment">// This function will be called exactly once for each window the EnumWindows function finds. We have no idea what</span>
		<span class="comment">// window / type of windows it'll get called for, so we'll have to identify the windows somehow. The lParam</span>
		<span class="comment">// parameter contains the value we passed when we called the EnumWindows function.</span>
		<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">EnumWindowsCallback</span>(<span class="keyword">int</span> handle, <span class="keyword">int</span> lParam)
		{
			<span class="comment">// First we'll find the class of the window as that is usually the parameter that narrows our search down the furthest.</span>
			<span class="comment">// As classes are usually rather short, a capacity of 256 ought to be plenty.</span>
			StringBuilder sbClass = <span class="keyword">new</span> StringBuilder(<span class="number">256</span>);
			GetClassName(handle, sbClass, sbClass.Capacity);

			<span class="comment">// As explained in an earlier blog we then get the text of the window.</span>
			<span class="keyword">int</span> txtLength = SendMessage(handle, WM_GETTEXTLENGTH, <span class="number">0</span>, <span class="number">0</span>);
			StringBuilder sbText = <span class="keyword">new</span> StringBuilder(txtLength + <span class="number">1</span>);
			SendMessage(handle, WM_GETTEXT, sbText.Capacity, sbText);

			<span class="comment">// Now we can write out the information we have on the window:</span>
			Console.WriteLine(<span class="string">"Handle: "</span> + handle);
			Console.WriteLine(<span class="string">"Class : "</span> + sbClass);
			Console.WriteLine(<span class="string">"Text  : "</span> + sbText);
			Console.WriteLine();

			<span class="comment">// When we return true, the EnumWindows function will proceed to call the callback function with the next window.</span>
			<span class="comment">// If we returned false, the EnumWindows function would stop and the callback function wouldn't get called again.</span>
			<span class="comment">// This can be useful if we're looking for a specific window - once it's found we can just return false, no reason</span>
			<span class="comment">// to handle any other windows.</span>
			<span class="keyword">return</span> <span class="keyword">true</span>;
		}
	}
}
</pre></figure>

<p>And the result:</p>
<div class="imgwrapper" style=""><div><a href="/enumerating-windows/win32_5_1_2.jpg" class="fancy"><img src="/enumerating-windows/win32_5_1_2.jpg" style="max-height: 250px"/></a></div></div>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">06</span>
		</div>
		<div class="lower">2007</div>
	</div>

	<div class="title">
		<h1><a href="/sending-keypresses-to-a-window/" title="Sending Keypresses to a Window Using PInvoke" rel="bookmark">Sending Keypresses to a Window Using PInvoke</a></h1>
		<div class="categories">
			
				<a href="/category/.NET/">.NET</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Now to complete the toolset required to make a great spyware / browser hijacking application, we’ll make Internet Explorer navigate to the address we set.</p>
<a id="more"></a>

<p><a href="http://www.improve.dk/blog/2007/04/03/getting-text-from-handle" target="_blank">Like before</a>, open an Internet Explorer browser and obtain a handle to the address field.</p>
<figure class="highlight cs"><pre><span class="keyword">using</span> System;
<span class="keyword">using</span> System.Runtime.InteropServices;
<span class="keyword">using</span> System.Globalization;

namespace Sending_keypresses_to_a_window
{
	class Program
	{
		<span class="comment">// A Win32 constant</span>
		<span class="keyword">const</span> <span class="keyword">int</span> WM_SETTEXT = <span class="number">0x000C</span>;
		<span class="keyword">const</span> <span class="keyword">int</span> WM_KEYDOWN = <span class="number">0x0100</span>;
		<span class="keyword">const</span> <span class="keyword">int</span> VK_RETURN  = <span class="number">0x0D</span>;

		<span class="comment">// An overload of the SendMessage function, this time taking in a string as the lParam.</span>
		[DllImport(<span class="string">"User32.dll"</span>)]
		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> Int32 <span class="title">SendMessage</span>(<span class="keyword">int</span> hWnd, <span class="keyword">int</span> Msg, <span class="keyword">int</span> wParam, <span class="keyword">string</span> lParam);

		<span class="comment">// PostMessage is very similar to SendMessage. They both send a message to the given</span>
		<span class="comment">// handle / window, the difference being that SendMessage sends the message and waits</span>
		<span class="comment">// for the window to "handle" the message and return a return code. PostMessage on the</span>
		<span class="comment">// other hand simply posts the message and returns instantly, whether the window</span>
		<span class="comment">// handles the message or not, we don't care.</span>
		[DllImport(<span class="string">"User32.Dll"</span>)]
		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> Int32 <span class="title">PostMessage</span>(<span class="keyword">int</span> hWnd, <span class="keyword">int</span> msg, <span class="keyword">int</span> wParam, <span class="keyword">int</span> lParam);

		<span class="keyword">static</span> <span class="keyword">void</span> Main(<span class="keyword">string</span>[] args)
		{
			<span class="comment">// First, read the handle from the console, remember this has to be in HEX format!</span>
			<span class="keyword">int</span> handle = <span class="keyword">int</span>.Parse(Console.ReadLine(), NumberStyles.HexNumber);

			<span class="comment">// Now we'll send the WM_SETTEXT message to the window, passing the text</span>
			<span class="comment">// through the lParam parameter.</span>
			SendMessage(handle, WM_SETTEXT, <span class="number">0</span>, <span class="string">"http://www.improve.dk"</span>);
			Console.WriteLine(<span class="string">"Text set!"</span>);

			<span class="comment">// Now send a message telling the Edit box that the Return key has been pressed,</span>
			<span class="comment">// resulting in Internet Explorer navigating to the page.</span>
			PostMessage(handle, WM_KEYDOWN, VK_RETURN, <span class="number">1</span>);
			Console.WriteLine(<span class="string">"Return keypress sent!"</span>);

			<span class="comment">// And we're done</span>
			Console.Read();
		}
	}
}
</pre></figure>

<p>And the result:</p>
<div class="imgwrapper" style=""><div><a href="/sending-keypresses-to-a-window/win32_4_1_2.jpg" class="fancy"><img src="/sending-keypresses-to-a-window/win32_4_1_2.jpg" style="max-height: 250px"/></a></div></div>

<div class="imgwrapper" style=""><div><a href="/sending-keypresses-to-a-window/win32_4_2_2.jpg" class="fancy"><img src="/sending-keypresses-to-a-window/win32_4_2_2.jpg" style="max-height: 250px"/></a></div></div>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">04</span>
		</div>
		<div class="lower">2007</div>
	</div>

	<div class="title">
		<h1><a href="/getting-text-from-handle/" title="Getting Text From Window Handle Using PInvoke" rel="bookmark">Getting Text From Window Handle Using PInvoke</a></h1>
		<div class="categories">
			
				<a href="/category/.NET/">.NET</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>This time we want to retrieve the text from a given window, represented by a handle. Like last time, open an Internet Explorer instance. Now open Winspector and select the address field, ensure that it is the address field itself (class = Edit) and not the ComboBox that you select.</p>
<a id="more"></a>

<div class="imgwrapper" style=""><div><a href="/getting-text-from-handle/win32_2_1_2.jpg" class="fancy"><img src="/getting-text-from-handle/win32_2_1_2.jpg" style="max-height: 250px"/></a></div></div>


<figure class="highlight cs"><pre><span class="keyword">using</span> System;
<span class="keyword">using</span> System.Collections.Generic;
<span class="keyword">using</span> System.Text;
<span class="keyword">using</span> System.Runtime.InteropServices;
<span class="keyword">using</span> System.Globalization;

namespace Get_text_from_handle
{
	class Program
	{
		<span class="comment">// These are two Win32 constants that we'll need, they'll be explained later.</span>
		<span class="keyword">const</span> <span class="keyword">int</span> WM_GETTEXT		= <span class="number">0x000D</span>;
		<span class="keyword">const</span> <span class="keyword">int</span> WM_GETTEXTLENGTH = <span class="number">0x000E</span>;

		<span class="comment">// The SendMessage function sends a Win32 message to the specified handle, it takes three</span>
		<span class="comment">// ints as parameters, the message to send, and to optional parameters (pass 0 if not required).</span>
		[DllImport(<span class="string">"User32.dll"</span>)]
		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> Int32 <span class="title">SendMessage</span>(<span class="keyword">int</span> hWnd, <span class="keyword">int</span> Msg, <span class="keyword">int</span> wParam, <span class="keyword">int</span> lParam);

		<span class="comment">// An overload of the SendMessage function, this time taking in a StringBuilder as the lParam.</span>
		<span class="comment">// Through the series we'll use a lot of different SendMessage overloads as SendMessage is one</span>
		<span class="comment">// of the most fundamental Win32 functions.</span>
		[DllImport(<span class="string">"User32.dll"</span>)]
		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> Int32 <span class="title">SendMessage</span>(<span class="keyword">int</span> hWnd, <span class="keyword">int</span> Msg, <span class="keyword">int</span> wParam, StringBuilder lParam);

		<span class="keyword">static</span> <span class="keyword">void</span> Main(<span class="keyword">string</span>[] args)
		{
			<span class="comment">// First, read the handle from the console, remember this has to be in HEX format!</span>
			<span class="keyword">int</span> handle = <span class="keyword">int</span>.Parse(Console.ReadLine(), NumberStyles.HexNumber);

			<span class="comment">// This is a bit tricky. To retrieve the text from a window, we have to know it's length beforehand.</span>
			<span class="comment">// This is because we have to send a StringBuilder of the correct length as a parameter. If it's too</span>
			<span class="comment">// small, it won't be able to contain the full text. If it's too large, it's inefficient. When using</span>
			<span class="comment">// the SendMessage function with the WM_GETTEXTLENGTH message, it returns the length of the</span>
			<span class="comment">// window text.</span>
			<span class="keyword">int</span> txtLength = SendMessage(handle, WM_GETTEXTLENGTH, <span class="number">0</span>, <span class="number">0</span>);

			<span class="comment">// After having retrieved the length of the string, we create a StringBuilder to hold it.</span>
			StringBuilder sb = <span class="keyword">new</span> StringBuilder(txtLength + <span class="number">1</span>);

			<span class="comment">// Sending the message WM_GETTEXT to the window, passing int he length of the text (the capacity</span>
			<span class="comment">// of the StringBuilder) as well as a reference to the StringBuilder will result in the</span>
			<span class="comment">// StringBuilder being filled up with the windows text.</span>
			SendMessage(handle, WM_GETTEXT, sb.Capacity, sb);

			<span class="comment">// Finally we'll write out the window text by ToString()'ing the StringBuilder.</span>
			Console.Write(sb.ToString());
			Console.Read();
		}
	}
}
</pre></figure>

<p>And the result:</p>
<div class="imgwrapper" style=""><div><a href="/getting-text-from-handle/win32_2_2_2.jpg" class="fancy"><img src="/getting-text-from-handle/win32_2_2_2.jpg" style="max-height: 250px"/></a></div></div>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">04</span>
		</div>
		<div class="lower">2007</div>
	</div>

	<div class="title">
		<h1><a href="/set-text-by-handle/" title="Set Text By Window Handle Using PInvoke" rel="bookmark">Set Text By Window Handle Using PInvoke</a></h1>
		<div class="categories">
			
				<a href="/category/.NET/">.NET</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>This time we won’t be reading the text from a window, we’ll be setting it.</p>
<a id="more"></a>

<p><a href="http://www.improve.dk/blog/2007/04/03/getting-text-from-handle" target="_blank">Like last time</a>, open an Internet Explorer browser and obtain a handle to the address field.</p>
<figure class="highlight cs"><pre><span class="keyword">using</span> System;
<span class="keyword">using</span> System.Collections.Generic;
<span class="keyword">using</span> System.Text;
<span class="keyword">using</span> System.Runtime.InteropServices;
<span class="keyword">using</span> System.Globalization;

namespace Set_text_by_handle
{
	class Program
	{
		<span class="comment">// A Win32 constant</span>
		<span class="keyword">const</span> <span class="keyword">int</span> WM_SETTEXT = <span class="number">0x000C</span>;

		<span class="comment">// An overload of the SendMessage function, this time taking in a string as the lParam.</span>
		[DllImport(<span class="string">"User32.dll"</span>)]
		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> Int32 <span class="title">SendMessage</span>(<span class="keyword">int</span> hWnd, <span class="keyword">int</span> Msg, <span class="keyword">int</span> wParam, <span class="keyword">string</span> lParam);

		<span class="keyword">static</span> <span class="keyword">void</span> Main(<span class="keyword">string</span>[] args)
		{
			<span class="comment">// First, read the handle from the console, remember this has to be in HEX format!</span>
			<span class="keyword">int</span> handle = <span class="keyword">int</span>.Parse(Console.ReadLine(), NumberStyles.HexNumber);

			<span class="comment">// Now we'll send the WM_SETTEXT message to the window, passing the text</span>
			<span class="comment">// through the lParam parameter.</span>
			SendMessage(handle, WM_SETTEXT, <span class="number">0</span>, <span class="string">"http://www.improve.dk"</span>);

			<span class="comment">// And we're done</span>
			Console.Write(<span class="string">"Text set!"</span>);
			Console.Read();
		}
	}
}
</pre></figure>

<p>And the result:</p>
<div class="imgwrapper" style=""><div><a href="/set-text-by-handle/win32_3_2_2.jpg" class="fancy"><img src="/set-text-by-handle/win32_3_2_2.jpg" style="max-height: 250px"/></a></div></div>

<p>Note that we have not navigated to the address, we have only set it!</p>
<div class="imgwrapper" style=""><div><a href="/set-text-by-handle/win32_3_1_2.jpg" class="fancy"><img src="/set-text-by-handle/win32_3_1_2.jpg" style="max-height: 250px"/></a></div></div>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">03</span>
		</div>
		<div class="lower">2007</div>
	</div>

	<div class="title">
		<h1><a href="/getting-a-process-from-a-handle/" title="Getting a Process From a Handle" rel="bookmark">Getting a Process From a Handle</a></h1>
		<div class="categories">
			
				<a href="/category/.NET/">.NET</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>So we have a handle, what process does it belong to? Our goal is to obtain a .NET System.Diagnostics.Process object that corresponds to the owner process of the handle we input.</p>
<a id="more"></a>

<p>Let’s first open up an Internet Explorer window, just leave it at the start page, whatever yours is.</p>
<div class="imgwrapper" style=""><div><a href="/getting-a-process-from-a-handle/win32_1_1_2.jpg" class="fancy"><img src="/getting-a-process-from-a-handle/win32_1_1_2.jpg" style="max-height: 250px"/></a></div></div>

<p>Now fire up Winspector and locate the Internet Explorer window, you’ll see the handle in HEX format in the treeview.</p>
<div class="imgwrapper" style=""><div><a href="/getting-a-process-from-a-handle/win32_1_2_2.jpg" class="fancy"><img src="/getting-a-process-from-a-handle/win32_1_2_2.jpg" style="max-height: 250px"/></a></div></div>


<figure class="highlight cs"><pre><span class="keyword">using</span> System;
<span class="keyword">using</span> System.Runtime.InteropServices;
<span class="keyword">using</span> System.Globalization;
<span class="keyword">using</span> System.Diagnostics;

namespace Get_process_from_handle
{
	class Program
	{
		<span class="comment">// The DllImport attribute specifies the Win32 DLL that contains the function we're importing,</span>
		<span class="comment">// in this case it's the user32.dll file that resides in the C:WindowsSystem32 directory.</span>
		<span class="comment">// The function we're importing is GetWindowThreadProcessId, it takes a handle and a reference</span>
		<span class="comment">// to an outgoing integer that'll return the process ID of the handle.</span>
		[DllImport(<span class="string">"user32"</span>)]
		<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">GetWindowThreadProcessId</span>(<span class="keyword">int</span> hWnd, <span class="keyword">out</span> <span class="keyword">int</span> lpdwProcessId);

		<span class="keyword">static</span> <span class="keyword">void</span> Main(<span class="keyword">string</span>[] args)
		{
			<span class="comment">// First, read the handle from the console, remember this has to be in HEX format!</span>
			<span class="keyword">int</span> handle = <span class="keyword">int</span>.Parse(Console.ReadLine(), NumberStyles.HexNumber);

			<span class="comment">// Now that we have the handle, create an uninitialized integer that'll hold the process ID</span>
			<span class="comment">// of the handle process.</span>
			<span class="keyword">int</span> processID;
			GetWindowThreadProcessId(handle, <span class="keyword">out</span> processID);

			<span class="comment">// Now that we have the process ID, we can use the built in .NET function to obtain a process object.</span>
			Process p = Process.GetProcessById(processID);

			<span class="comment">// Finally we'll write out the process name to confirm success.</span>
			Console.Write(p.ProcessName);
			Console.Read();
		}
	}
}
</pre></figure>

<p>And the result:</p>
<div class="imgwrapper" style=""><div><a href="/getting-a-process-from-a-handle/win32_1_3_2.jpg" class="fancy"><img src="/getting-a-process-from-a-handle/win32_1_3_2.jpg" style="max-height: 250px"/></a></div></div>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">02</span>
		</div>
		<div class="lower">2007</div>
	</div>

	<div class="title">
		<h1><a href="/the-basics/" title="The Basics" rel="bookmark">The Basics</a></h1>
		<div class="categories">
			
				<a href="/category/.NET/">.NET</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>First of all, to manipulate and use the Win32 API, we must know about the system itself, the windows, the controls and so forth. Visual Studio comes bundled with Spy++ which enables us to identity the various windows and controls of application, but honestly, it’s pretty bad. Instead you should <a href="http://www.windows-spy.com/" target="_blank">download Winspector</a>.</p>
<a id="more"></a>

<h2 id="Threads_&amp;_processes">Threads &amp; processes</h2>
<p>Each application/window in Windows belongs to a given thread under a given process. A process may have multiple threads and windows, but a thread and a window can only belong to a single process.</p>
<h2 id="Windows_&amp;_handles">Windows &amp; handles</h2>
<p>Usually we refer to a window as the overall container of visual representation of data in Windows, in this case it’s a bit more detailed though. In all API work a window is a standard Win32 control, that could be a button, a toolbar, a label, a window (as per the usual definition) and so forth. Each window is assigned a handle, and by using this handle we can uniquely reference any given window. A window may have any number of child windows, that could be the controls of a dialog box, and the children may have children themselves and so forth.</p>
<p>Try and mess around with Winspector a bit. Identify the various windows of the system (including those that are not visible). Inspect their properties, the process they belong to, their parent windows and so forth. Most, if not all, of the API tips &amp; tricks posts will include references to windows, handles, processes and threads - so get used to them.</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Mar</span>
			<span class="day">29</span>
		</div>
		<div class="lower">2007</div>
	</div>

	<div class="title">
		<h1><a href="/turning-the-world-upside-down/" title="Turning the World Upside Down" rel="bookmark">Turning the World Upside Down</a></h1>
		<div class="categories">
			
				<a href="/category/Tools of the Trade/">Tools of the Trade</a>
				, 
			
				<a href="/category/Windows/">Windows</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>So, tell me, do you notice anything unusual in the picture below?</p>
<a id="more"></a>

<div class="imgwrapper" style=""><div><a href="/turning-the-world-upside-down/upsidedown_2.jpg" class="fancy"><img src="/turning-the-world-upside-down/upsidedown_2.jpg" style="max-height: 250px"/></a></div></div>

<p>For a month or so I’ve used my computer with the Windows Start menu at the top. Am I crazy? Most likely. I started out doing it on my home computer (on all monitors), while keeping the start menu at the bottom at work. Honestly, it is feels quite weird and wrong in the beginning, and I was constantly throwing my mouse southwards just to realize that my work had been for nothing, as the Start menu was actually up north. I really couldn’t impose this waste of time upon my employers, that’s why I kept it down south there.</p>
<p>After a couple of weeks had passed, things started to shift. I was now starting to notice how wrong it was for the Start menu to be at the bottom at work - and how cumbersome it really is! So I moved it. And everybody laughed at me.</p>
<p>So why’d you want to move your Start menu to the top of the monitor?</p>
<div class="imgwrapper" style=""><div><a href="/turning-the-world-upside-down/topmenu_2.jpg" class="fancy"><img src="/turning-the-world-upside-down/topmenu_2.jpg" style="max-height: 250px"/></a></div></div>

<p>See how all the menus are in the top? Usually - excluding gaming and other special applications - our mouse will be working inside a menu, dragging a window, using the Start menu, or in the main content area of a browser/application. Common to most of these are that they all happen at the top of the monitor. As the monitor gets larger, the distance between the top and the bottom becomes greater.</p>
<p>Having the Start menu at the top really saves a lot of mouse movement. The only negative side that I’ve become aware of is that you can’t just toss the mouse top-right like a maniac and click to close a window - that’ll now activate the system clock. When using multiple monitors, that really isn’t an issue as you wouldn’t be able to do that anyways since your mouse would enther the other monitor.</p>
<p>The greatest opponent of this efficiency improvement really is… Tradition. I shall not try to hide the fact that it takes a lot of getting used to. After having moved my mouse towards the bottom and hammering a fist in the table for the 100th time, I was almost about to give up. But hang in, for the sake of your carpal tunnel syndrome suffering hand, MOVE THAT START MENU!</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Mar</span>
			<span class="day">29</span>
		</div>
		<div class="lower">2007</div>
	</div>

	<div class="title">
		<h1><a href="/dedicated-to-the-api/" title="Dedicated to the API" rel="bookmark">Dedicated to the API</a></h1>
		<div class="categories">
			
				<a href="/category/.NET/">.NET</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Unfortunately it’s been quite silent around here for the last couple of months. I want to change that, so why not make a promise?</p>
<a id="more"></a>

<p>I’ve always been bullied by my wannabe developer friends for memorizing most of the Win32 (XP onwards) API. What they don’t realize is just how useful the API is - how powerful it is!</p>
<p>For the complete month of April 2007, I will post a new blog each day containing a Win32 API trick including demonstration code. Although my samples will be in C#, this being the Win32 API, it’s actually usable in more or less any language you want.</p>
<p>I look forward to my missionary work in the name of the holy Win32 API!</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Mar</span>
			<span class="day">16</span>
		</div>
		<div class="lower">2007</div>
	</div>

	<div class="title">
		<h1><a href="/car-fire/" title="Car fire :(" rel="bookmark">Car fire :(</a></h1>
		<div class="categories">
			
				<a href="/category/Life/">Life</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Boy am I glad I’ve got my baby insured, guess I’ll need it now :(</p>
<a id="more"></a>

<div class="imgwrapper" style=""><div><a href="/car-fire/carburn1_2.jpg" class="fancy"><img src="/car-fire/carburn1_2.jpg" style="max-height: 250px"/></a></div></div>

<div class="imgwrapper" style=""><div><a href="/car-fire/carburn2_2.jpg" class="fancy"><img src="/car-fire/carburn2_2.jpg" style="max-height: 250px"/></a></div></div>

<div class="imgwrapper" style=""><div><a href="/car-fire/carburn3_2.jpg" class="fancy"><img src="/car-fire/carburn3_2.jpg" style="max-height: 250px"/></a></div></div>

<div class="imgwrapper" style=""><div><a href="/car-fire/carburn4_2.jpg" class="fancy"><img src="/car-fire/carburn4_2.jpg" style="max-height: 250px"/></a></div></div>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Feb</span>
			<span class="day">25</span>
		</div>
		<div class="lower">2007</div>
	</div>

	<div class="title">
		<h1><a href="/uml-love/" title="UML Love" rel="bookmark">UML Love</a></h1>
		<div class="categories">
			
				<a href="/category/Poker/">Poker</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>I was asked to make a graph of my most recent relationship, what other way is there to express oneself than UML?</p>
<a id="more"></a>

<p>My world:</p>
<div class="imgwrapper" style=""><div><a href="/uml-love/relationdiagram_2.jpg" class="fancy"><img src="/uml-love/relationdiagram_2.jpg" style="max-height: 250px"/></a></div></div>

<p>My relationship:</p>
<div class="imgwrapper" style=""><div><a href="/uml-love/relationtimeline_2.jpg" class="fancy"><img src="/uml-love/relationtimeline_2.jpg" style="max-height: 250px"/></a></div></div>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>


<div class="paging">
	<a href="/page/21/"><div class="past">« Past</div></a>
	<a href="/page/19/"><div class="future">Future »</div></a>
	<div class="clear"></div>
</div>

				</div>
			</div>

			<div id="asides">
				<div class="categories aside">
					<span class="sectiontitle">CATEGORIES</span>
					<ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/category/.NET/">.NET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/AS/Flex/Flash/">AS/Flex/Flash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Amazon Web Services/">Amazon Web Services</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Computer Science/">Computer Science</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Conferences and Presenting/">Conferences and Presenting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/IIS/">IIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Life/">Life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Miscellaneous/">Miscellaneous</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Performance/">Performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Poker/">Poker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server/">SQL Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Community/">SQL Server - Community</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Data Types/">SQL Server - Data Types</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Internals/">SQL Server - Internals</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Optimization/">SQL Server - Optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - OrcaMDF/">SQL Server - OrcaMDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Tricks/">SQL Server - Tricks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Testing/">Testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Tools of the Trade/">Tools of the Trade</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Umbraco/">Umbraco</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Visual Studio/">Visual Studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Web/">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Windbg/">Windbg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Windows/">Windows</a></li></ul>

					
				</div>

				<div class="archive aside">
					<span class="sectiontitle">ARCHIVE</span>
					<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archive/2014">2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2013">2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2012">2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2011">2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2010">2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2009">2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2008">2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2007">2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2006">2006</a></li></ul>
				</div>
			</div>

			<div class="clear"></div>
		</div>
		
		<footer>
			<div class="wrapper">Copyright &copy; 2014 Mark S. Rasmussen</div>
		</footer>

		<script type="text/javascript">
			$(function () {
				// Show mobile menu
				$("li.navicon").click(function () {
					if ($("header ul.mobile a").length == 0) {
						// Pages
						$mobilePages = $("div#naviconcontent ul.pages");
						$("header nav ul.normal > li").not(".navicon").each(function (i, el) {
							$mobilePages.append($(el).clone());
						});

						// Categories
						$mobileCategories = $("div#naviconcontent ul.categories");
						$("div#asides div.categories > ul > li").each(function (i, el) {
							$mobileCategories.append($(el).clone());
						});

						// Archive
						$mobileArchive = $("div#naviconcontent ul.archive");
						$("div#asides div.archive > ul > li").each(function (i, el) {
							$mobileArchive.append($(el).clone());
						});
					};

					$("header ul.mobile").toggle();
				});

				// Fancybox setup
				$("a.fancy").fancybox({
					hideOnContentClick: true,
					overlayShow: true
				});
			});
		</script>
	</body>
</html>