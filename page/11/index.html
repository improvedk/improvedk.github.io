<!DOCTYPE html>
<html>
	

<head>
	<title>Mark S. Rasmussen</title>
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
	<meta charset="UTF-8" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="website" />
	<meta name="google-site-verification" content="alt7-wfK3ZujMQ4D0jYNd0yC5LGetGdqBlBmZsqQlVw" />
	<link rel="alternative" href="http://feeds.feedburner.com/Improvedk" title="Mark S. Rasmussen" type="application/atom+xml">
	<script src="/js/combined.js"></script>
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-2479580-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>
	<link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
	<body>
		<div id="headerline"></div>
	
		<header>
			<div class="wrapper">
				<div id="title">
					<a href="/">Mark S. Rasmussen</a> <span>improve.dk</span>
				</div>
				
				<nav>
					<ul class="normal">
						<li class="navicon"><img src="/img/navicon.png" /></li>
						<li><a href="/about-me/">About Me</a></li>
					</ul>
				</nav>
				
				<ul id="sharing">
					<li><a href="mailto:mark@improve.dk"><img src="/img/at.png" /></a></li>
					<li><a href="http://feeds.feedburner.com/Improvedk"><img src="/img/rss.png" /></a></li>
					<li><a href="https://twitter.com/improvedk"><img src="/img/twitter.png" /></a></li>
					<li><a href="https://github.com/improvedk"><img src="/img/github.png" /></a></li>
					<li><a href="https://www.linkedin.com/in/markrasmussen/"><img src="/img/linkedin.png" /></a></li>
				</ul>

				<div class="clear"></div>
				
				<div id="naviconcontent">
					<ul class="mobile">
						<li>
							Pages
							<ul class="pages"></ul>
						</li>
						<li>
							Categories
							<ul class="categories"></ul>
						</li>
						<li>
							Archive
							<ul class="archive"></ul>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div id="mainwrapper">
			<div id="contentwrapper">
				<div id="content">
				
					
	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">17</span>
		</div>
		<div class="lower">2011</div>
	</div>

	<div class="title">
		<h1><a href="/miracle-open-world-2011-follow-up/" title="Miracle Open World 2011 Followup" rel="bookmark">Miracle Open World 2011 Followup</a></h1>
		<div class="categories">
			
				<a href="http://improve.dk/category/Conferences and Presenting/">Conferences and Presenting</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Last week I attended the <a href="http://mow2011.dk/" target="_blank">Miracle Open World 2011 conference</a>. As in the previous years the 80% content, 80% social moniker held true to its reputation. My legs and arms are still sore from carrying four-man rubber rings to the top of the four-story waterslide – not the typical aftermath of a conference. I met a lot of new awesome people and managed to pull of a couple of presentations with decent success as well, judging from the responses I’ve had so far. I’ve included the slides &amp; demo code for the presentations below.</p>
<a id="more"></a>

<div class="imgwrapper" style=""><div><a href="/miracle-open-world-2011-follow-up/mow2011Black_2.png" class="fancy"><img src="/miracle-open-world-2011-follow-up/mow2011Black_2.png" style="max-height: 250px"/></a></div></div>

<h2 id="Anatomy_of_an_MDF_File">Anatomy of an MDF File</h2>
<p><em>Ever felt like SQL Server slowed you down, and you’d rather just get the data yourself using a HEX editor? In this deep dive session I’ll give a run through of the MDF file format, what kind of page types exists? How are records stored on pages? How can we use this knowledge for optimizing performance and (catastrophic) disaster recovery? This session is not for the faint of heart. There will be bytes!</em></p>
<p><a href="Anatomy-of-an-MDF-File.pdf">Slides</a><br><a href="DBCC-Page.zip">Code</a></p>
<h2 id="How_GUIDs_Will_Ruin_Your_Life">How GUIDs Will Ruin Your Life</h2>
<p><em>GUIDs make our lives simpler in lots of ways - reducing rountrips, decentralized ID generation, pseudo-security, etc. However, they come with a hefty price that may be overlooked untill it’s too late.</em></p>
<p><em>In this session I will give a thorough review of the hidden costs of using GUIDs in your systems. As they may be required, I will look at ways to alleviate the cost of GUIDs while still maintaining the semantic functionality</em></p>
<p><a href="How-GUIDs-Will-Ruin-Your-Life.pdf">Slides</a><br><a href="Demo_code.zip">Code</a></p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Jul</span>
			<span class="day">01</span>
		</div>
		<div class="lower">2010</div>
	</div>

	<div class="title">
		<h1><a href="/papercut-vs-smtp4dev-testing-mail-sending-locally/" title="Papercut vs smtp4dev - Testing Mail Sending Locally" rel="bookmark">Papercut vs smtp4dev - Testing Mail Sending Locally</a></h1>
		<div class="categories">
			
				<a href="http://improve.dk/category/.NET/">.NET</a>
				, 
			
				<a href="http://improve.dk/category/Tools of the Trade/">Tools of the Trade</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Testing mail functionality in code using external mail servers has always been a hassle. If the mail manages to dodge antispam and various other mischievous services, it’ll probably take several minutes to receive. On our Exchange servers it’ll typically take 10-15 minutes before a locally sent mail actually arrives back in my inbox. We can do better!</p>
<a id="more"></a>

<p><a href="http://papercut.codeplex.com" target="_blank">Papercut</a> and <a href="http://smtp4dev.codeplex.com" target="_blank">smtp4dev</a> are both applications that’ll emulate a remote SMTP server on your local machine. Instead of actually sending the mail onwards like a normal SMTP server, they’ll simply catch the mail and notify you. This means you’ll receive the mail instantly without any risks of being caught in spam filters or dying of old age before receiving the mail. I’ve tried out both Papercut and smtp4dev and here are some thoughts on both.</p>
<p>For the testing I’m using this rather simple piece of code:</p>
<h3 id="Program-cs_"><strong>Program.cs </strong></h3>
<figure class="highlight csharp"><pre><span class="keyword">using</span> System.Net.Mail;

<span class="class"><span class="keyword">namespace</span> <span class="title">MailTest</span>
{</span>
    <span class="class"><span class="keyword">class</span> <span class="title">Program</span>
    {</span>
        <span class="keyword">static</span> <span class="keyword">void</span> Main()
        {
            <span class="keyword">var</span> sc = <span class="keyword">new</span> SmtpClient();
            sc.Host = <span class="string">"127.0.0.1"</span>;

            <span class="keyword">var</span> mail = <span class="keyword">new</span> MailMessage(<span class="string">"mark+from@improve.dk"</span>, <span class="string">"mark+to@improve.dk"</span>)
                        {
                            Subject = <span class="string">"My subject"</span>,
                            Body = <span class="string">"My body"</span>
                        };

            sc.Send(mail);
        }
    }
}
</pre></figure>

<h2 id="Papercut">Papercut</h2>
<div class="imgwrapper" style=""><div><a href="/papercut-vs-smtp4dev-testing-mail-sending-locally/papercut1_2.jpg" class="fancy"><img src="/papercut-vs-smtp4dev-testing-mail-sending-locally/papercut1_2.jpg" style="max-height: 250px"/></a></div></div>

<div class="imgwrapper" style=""><div><a href="/papercut-vs-smtp4dev-testing-mail-sending-locally/papercut2_2.jpg" class="fancy"><img src="/papercut-vs-smtp4dev-testing-mail-sending-locally/papercut2_2.jpg" style="max-height: 250px"/></a></div></div>

<h3 id="+_Xcopy_deployment">+ Xcopy deployment</h3>
<p>I love the fact that I can just unzip the download and run the .exe right away, no installation, no configuration.</p>
<h3 id="+_Dead_simple">+ Dead simple</h3>
<p>It lacks some features, but when all you need is to quickly check the contents of a sent email, the simplicity of Papercut makes it extremely fast to use.</p>
<h3 id="+_HTML_view_directly_in_interface">+ HTML view directly in interface</h3>
<p>Unlike smtp4dev, Papercut will display HTML email contents directly in the interface without having to open the mail in Outlook (which I don’t even have on my machine).</p>
<h3 id="+_Forwarding_option">+ Forwarding option</h3>
<p>If you need to forward the mail to a colleague you can do it right in the interface. It’ll prompt you for an SMTP server to use - unfortunately it’s not possible to provide authentication credentials.</p>
<h3 id="-_HTML_view_should_open_links_in_new_window">- HTML view should open links in new window</h3>
<p>When checking out HTML emails I often want to verify that links are correct. Papercut will open them directly in the Papercut interface, making it hard to verify the address.</p>
<h3 id="-_Lacks_simple_connection_status_in_interface">- Lacks simple connection status in interface</h3>
<p>There’s no green bar/indicator for whether Papercut is actively listening of if it’s been obstructed or failed to bind to the port on startup.</p>
<h3 id="-_Lacks_simple_way_to_open_-eml_files">- Lacks simple way to open .eml files</h3>
<p>Both Papercut and smtp4dev save the emails as .eml files that can easily be opened by Outlook or antoher compatible mail client. In Papercut you have to find the executable folder and open the files directly though. A simple double-click function would be nice.</p>
<h3 id="-_No_way_to_quickly_delete_all_mails">- No way to quickly delete all mails</h3>
<p>You have to delete all incoming mails one by one.</p>
<h2 id="smtp4dev">smtp4dev</h2>
<div class="imgwrapper" style=""><div><a href="/papercut-vs-smtp4dev-testing-mail-sending-locally/smtp4dev4_2.jpg" class="fancy"><img src="/papercut-vs-smtp4dev-testing-mail-sending-locally/smtp4dev4_2.jpg" style="max-height: 250px"/></a></div></div>

<div class="imgwrapper" style=""><div><a href="/papercut-vs-smtp4dev-testing-mail-sending-locally/smtp4dev3_2.jpg" class="fancy"><img src="/papercut-vs-smtp4dev-testing-mail-sending-locally/smtp4dev3_2.jpg" style="max-height: 250px"/></a></div></div>

<h3 id="+_Inspection_shows_formatted_headers">+ Inspection shows formatted headers</h3>
<p>The inspection view lists headers in a table for easier reading.</p>
<h3 id="+_Inspection_shows_mime_parts">+ Inspection shows mime parts</h3>
<p>If your mail contains multiple mime parts, they can easily be seen separately in the inspection interface.</p>
<h3 id="+_More_UI_options">+ More UI options</h3>
<p>smtp4dev enables you to delete all mails easily, has context menu options when right clicking the notification icon as well as generally more UI options than Papercut.</p>
<h3 id="+_Lots_more_options">+ Lots more options</h3>
<p>smtp4dev has vastly more options than Papercut. smtp4dev supports authentication, SSL and various other options, while Papercut only supports defining the listening port.</p>
<h3 id="+_List_of_SMTP_sessions">+ List of SMTP sessions</h3>
<p>Using the sessions tab you can easily see how many SMTP sessions have occurred, as well as how many mails were sent as part of that session.</p>
<div class="imgwrapper" style=""><div><a href="/papercut-vs-smtp4dev-testing-mail-sending-locally/smtp4dev5_2.jpg" class="fancy"><img src="/papercut-vs-smtp4dev-testing-mail-sending-locally/smtp4dev5_2.jpg" style="max-height: 250px"/></a></div></div>

<h3 id="+_More_activity_on_Codeplex">+ More activity on Codeplex</h3>
<p>smtp4dev has somewhat more discussion activity as well as recent commit activity, whereas Papercut seems somewhat more abandoned.</p>
<h3 id="-_Cumbersome_message_viewing">- Cumbersome message viewing</h3>
<p>Viewing the actual email messages requires either opening the .eml files in a mail viewer application or opening up the inspection interface. Papercut is much faster since you can view the body directly in the list interface. A reading pane option would be nice.</p>
<h3 id="-_Requires_installation">- Requires installation</h3>
<p>An application like this is meant to be lightweight and easily fired up when required. smtp4dev requires installation and even offers you to let it start on bootup. It might be a matter of preferences, but I really like Papercuts xcopy deployment.</p>
<div class="imgwrapper" style=""><div><a href="/papercut-vs-smtp4dev-testing-mail-sending-locally/smtp4dev1_2.jpg" class="fancy"><img src="/papercut-vs-smtp4dev-testing-mail-sending-locally/smtp4dev1_2.jpg" style="max-height: 250px"/></a></div></div>

<h3 id="-_Autoupdate">- Autoupdate</h3>
<p>Expanding on the point above; a tool like this is not a tool that I really need to have checking for updates automatically. I know, I can’t really make this a minus, but still, KISS.</p>
<h3 id="-_Crashes">- Crashes</h3>
<p>While I haven’t been able to make a reproduction case, smtp4dev crashed on me a couple of times, seemingly while running in the background without SMTP activity.</p>
<h2 id="Conclusion">Conclusion</h2>
<p>So which is best? It depends! I use both… If all I need is to quickly check a single mails contents then I’ll fire up Papercut. If I need to catch multiple emails and perhaps inspect the contents more thoroughly, I’ll use smtp4dev. Generally I prefer to use Papercut if I don’t need any further features.</p>
<p>Both projects’ source code seems decent, though I’ve just skimmed quickly. smtp4dev generally seems more robust and also includes a limited amount of unit tests.</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Jun</span>
			<span class="day">21</span>
		</div>
		<div class="lower">2010</div>
	</div>

	<div class="title">
		<h1><a href="/routing-requests-for-a-subdirectory-to-another-server-using-iis-application-request-routing/" title="Routing Requests for a Subdirectory to Another Server Using IIS Application Request Routing" rel="bookmark">Routing Requests for a Subdirectory to Another Server Using IIS Application Request Routing</a></h1>
		<div class="categories">
			
				<a href="http://improve.dk/category/IIS/">IIS</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>In this post I’ll walk you through how to setup <a href="http://www.iis.net/download/applicationrequestrouting" target="_blank">IIS Application Request Routing</a> so that any requests for a /wiki/ subdirectory are routed onto a separate server, while all other requests are handled by the server itself.</p>
<a id="more"></a>

<p>Let’s imagine a fictional scenario where I want to add a wiki to my website. Thus, all requests to improve.dk/wiki/* are mapped to a dedicated LAMP based server that runs some kind of wiki software. All other requests should be served by the normal improve.dk webserver.</p>
<p>The first task is to setup a new server farm, called Wiki in my case. Add the server to the list of servers, using its hostname, MyWikiServer in this case. If you setup (temporarily, for testing) improve.dk so it maps to the wiki server, requesting <a href="http://improve.dk/Wiki/">http://improve.dk/Wiki/</a> should return back the expected result from the wiki server, if requested from the normal webserver.</p>
<div class="imgwrapper" style=""><div><a href="/routing-requests-for-a-subdirectory-to-another-server-using-iis-application-request-routing/rrsa1_2.jpg" class="fancy"><img src="/routing-requests-for-a-subdirectory-to-another-server-using-iis-application-request-routing/rrsa1_2.jpg" style="max-height: 250px"/></a></div></div>


<figure class="highlight xml"><pre><span class="tag">&lt;<span class="title">webfarms</span>&gt;</span>
    <span class="tag">&lt;<span class="title">webfarm</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">name</span>=<span class="value">"Wiki"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">server</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">address</span>=<span class="value">"MyWikiServer"</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">server</span>&gt;</span><span class="tag">&lt;/<span class="title">webfarm</span>&gt;</span>
    <span class="tag">&lt;<span class="title">applicationrequestrouting</span>&gt;</span>
        <span class="tag">&lt;<span class="title">hostaffinityproviderlist</span>&gt;</span>
            <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">"Microsoft.Web.Arr.HostNameRoundRobin"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">"Microsoft.Web.Arr.HostNameMemory"</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">add</span>&gt;</span><span class="tag">&lt;/<span class="title">add</span>&gt;</span><span class="tag">&lt;/<span class="title">hostaffinityproviderlist</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">applicationrequestrouting</span>&gt;</span>
<span class="tag">&lt;/<span class="title">webfarms</span>&gt;</span>
</pre></figure>

<p>Next, setup a URL Rewrite rule at the global level like the following:</p>
<div class="imgwrapper" style=""><div><a href="/routing-requests-for-a-subdirectory-to-another-server-using-iis-application-request-routing/rrsa2_2.jpg" class="fancy"><img src="/routing-requests-for-a-subdirectory-to-another-server-using-iis-application-request-routing/rrsa2_2.jpg" style="max-height: 250px"/></a></div></div>

<p>The rule matches all requests for the /wiki/ directory, whether there’s a trailing slash or further subdirectories. It ensures not to match a request like /wikipedia/. The request is routed onto the Wiki webfarm which sends the request onto the MyWikiServer server. Note that there’s a condition ensuring this rule will only match requests for the improve.dk domain so other websites aren’t affected. There are no changes to the actual improve.dk website setup.</p>
<p><strong>Correction:</strong> As noted by Rob Hudson, the regular expression should actually be:</p>
<blockquote>
<p>^wiki$|^wiki/(.*)</p>
</blockquote>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Jun</span>
			<span class="day">16</span>
		</div>
		<div class="lower">2010</div>
	</div>

	<div class="title">
		<h1><a href="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/" title="Setting up Multiple IIS Application Request Routing Farms on the Same Server" rel="bookmark">Setting up Multiple IIS Application Request Routing Farms on the Same Server</a></h1>
		<div class="categories">
			
				<a href="http://improve.dk/category/IIS/">IIS</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Inspired by a <a href="http://forums.iis.net/t/1168684.aspx" target="_blank">post on the ARR forums</a>, let me walk you through how to setup multiple <a href="http://www.iis.net/download/applicationrequestrouting" target="_blank">IIS Application Request Routing</a> server farms on a single machine.</p>
<a id="more"></a>

<h2 id="The_scenario">The scenario</h2>
<p>I own a bunch of search engines, <a href="http://bing.com/" target="_blank">bing.com</a>, <a href="http://google.com/" target="_blank">google.com</a> and <a href="http://yahoo.com/" target="_blank">yahoo.com</a>. Likewise, I own a bunch of news sites <a href="http://cnn.com/" target="_blank">cnn.com</a>, <a href="http://english.aljazeera.net/" target="_blank">english.aljazeera.net</a> and <a href="http://foxnews.com/" target="_blank">foxnews.com</a>(alright, bear with me on that last one, just using it as an example). Luckily, my users don’t really care which search engine or news site they go to, as long as they end up at “a” search engine or “a” news site. To help me distribute the load we’ll setup two IIS ARR web farms that’ll load balance between the news sites and search engines.</p>
<h2 id="Setting_up_the_farms">Setting up the farms</h2>
<p>Start by <a href="http://learn.iis.net/page.aspx/482/install-application-request-routing/" target="_blank">installing the Application Request Routing module</a> if you haven’t done so already. Now create two sever farms called “News” and “Search”. Add the search &amp; news websites to each of their server farms like so:</p>
<div class="imgwrapper" style=""><div><a href="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_1_2.jpg" class="fancy"><img src="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_1_2.jpg" style="max-height: 250px"/></a></div></div>

<p>You may also setup the farms directly in applicationHost.config:</p>
<figure class="highlight xml"><pre><span class="tag">&lt;<span class="title">webfarms</span>&gt;</span>
    <span class="tag">&lt;<span class="title">webfarm</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">name</span>=<span class="value">"News"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">server</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">address</span>=<span class="value">"cnn.com"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">server</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">address</span>=<span class="value">"foxnews.com"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">server</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">address</span>=<span class="value">"english.aljazeera.net"</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">server</span>&gt;</span><span class="tag">&lt;/<span class="title">server</span>&gt;</span><span class="tag">&lt;/<span class="title">server</span>&gt;</span><span class="tag">&lt;/<span class="title">webfarm</span>&gt;</span>
    <span class="tag">&lt;<span class="title">webfarm</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">name</span>=<span class="value">"Search"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">server</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">address</span>=<span class="value">"google.com"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">server</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">address</span>=<span class="value">"bing.com"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">server</span> <span class="attribute">enabled</span>=<span class="value">"true"</span> <span class="attribute">address</span>=<span class="value">"yahoo.com"</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">server</span>&gt;</span><span class="tag">&lt;/<span class="title">server</span>&gt;</span><span class="tag">&lt;/<span class="title">server</span>&gt;</span><span class="tag">&lt;/<span class="title">webfarm</span>&gt;</span>
    <span class="tag">&lt;<span class="title">applicationrequestrouting</span>&gt;</span>
        <span class="tag">&lt;<span class="title">hostaffinityproviderlist</span>&gt;</span>
            <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">"Microsoft.Web.Arr.HostNameRoundRobin"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">add</span> <span class="attribute">name</span>=<span class="value">"Microsoft.Web.Arr.HostNameMemory"</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">add</span>&gt;</span><span class="tag">&lt;/<span class="title">add</span>&gt;</span><span class="tag">&lt;/<span class="title">hostaffinityproviderlist</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">applicationrequestrouting</span>&gt;</span>
<span class="tag">&lt;/<span class="title">webfarms</span>&gt;</span>
</pre></figure>

<h2 id="Setting_up_the_rules">Setting up the rules</h2>
<p>Go to the IIS level “URL Rewrite” settings page. If any default rules were created in the installation of IIS ARR, delete them now. Create a new rule from the blank template and call it “search.local”. Set the Match URL to use Wildcards and enter a pattern of “*”. This ensures that the rule matches and URL that we send to the server - no matter the hostname.</p>
<div class="imgwrapper" style=""><div><a href="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_2_2.jpg" class="fancy"><img src="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_2_2.jpg" style="max-height: 250px"/></a></div></div>

<p>Expand the Conditions pane and add a new condition. Set the input to “{HTTP_HOST}” and type the pattern “search.local”. The {HTTP_HOST} condition ensures that this rule only matches requests to the search.local hostname.</p>
<div class="imgwrapper" style=""><div><a href="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_3_2.jpg" class="fancy"><img src="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_3_2.jpg" style="max-height: 250px"/></a></div></div>

<p>Finally set the action type to “Route to Server Farm” and choose the Search server farm. Tick the “Stop processing of subsequent rules” as the request should be routed onto the server farm as soon as this rule matches.</p>
<div class="imgwrapper" style=""><div><a href="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_4_2.jpg" class="fancy"><img src="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_4_2.jpg" style="max-height: 250px"/></a></div></div>

<p>As the last step, create a second identical rule except it should be named news.local and have an {HTTP_POST} condition matching the news.local hostname. Setting up the rewrite rules can also be done in applicaitonHOst.config directly:</p>
<figure class="highlight xml"><pre><span class="tag">&lt;<span class="title">rewrite</span>&gt;</span>
    <span class="tag">&lt;<span class="title">globalrules</span>&gt;</span>
        <span class="tag">&lt;<span class="title">rule</span> <span class="attribute">name</span>=<span class="value">"search.local"</span> <span class="attribute">stopprocessing</span>=<span class="value">"true"</span> <span class="attribute">patternsyntax</span>=<span class="value">"Wildcard"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">match</span> <span class="attribute">url</span>=<span class="value">"*"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">action</span> <span class="attribute">url</span>=<span class="value">"http://Search/{R:0}"</span> <span class="attribute">type</span>=<span class="value">"Rewrite"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">conditions</span>&gt;</span>
                <span class="tag">&lt;<span class="title">add</span> <span class="attribute">pattern</span>=<span class="value">"search.local"</span> <span class="attribute">input</span>=<span class="value">"{HTTP_HOST}"</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">add</span>&gt;</span><span class="tag">&lt;/<span class="title">conditions</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">action</span>&gt;</span><span class="tag">&lt;/<span class="title">match</span>&gt;</span><span class="tag">&lt;/<span class="title">rule</span>&gt;</span>
        <span class="tag">&lt;<span class="title">rule</span> <span class="attribute">name</span>=<span class="value">"news.local"</span> <span class="attribute">stopprocessing</span>=<span class="value">"true"</span> <span class="attribute">patternsyntax</span>=<span class="value">"Wildcard"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">match</span> <span class="attribute">url</span>=<span class="value">"*"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">action</span> <span class="attribute">url</span>=<span class="value">"http://News/{R:0}"</span> <span class="attribute">type</span>=<span class="value">"Rewrite"</span>&gt;</span>
            <span class="tag">&lt;<span class="title">conditions</span>&gt;</span>
                <span class="tag">&lt;<span class="title">add</span> <span class="attribute">pattern</span>=<span class="value">"news.local"</span> <span class="attribute">input</span>=<span class="value">"{HTTP_HOST}"</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">add</span>&gt;</span><span class="tag">&lt;/<span class="title">conditions</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">action</span>&gt;</span><span class="tag">&lt;/<span class="title">match</span>&gt;</span><span class="tag">&lt;/<span class="title">rule</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">globalrules</span>&gt;</span>
<span class="tag">&lt;/<span class="title">rewrite</span>&gt;</span>
</pre></figure>

<p>Once done, your rules should look like this:</p>
<div class="imgwrapper" style=""><div><a href="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_5_2.jpg" class="fancy"><img src="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_5_2.jpg" style="max-height: 250px"/></a></div></div>

<h2 id="Testing_the_farms">Testing the farms</h2>
<p>Create two host entries in your %windir%System32Driversetchosts file that makes news.local and search.local point to 127.0.0.1. Now when you open a browser and enter news.local or search.local, you should hit the search engines and news sites we setup earlier. By default IIS ARR will distribute the requests to the server with the least current requests - and since we’re the only ones hitting them we’ll basically always just hit the first server. To alleviate this you can change the load distribution mode to a weighted round robin with even distribution, that’ll ensure you hit the sites one by one in turn.</p>
<div class="imgwrapper" style=""><div><a href="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_6_2.jpg" class="fancy"><img src="/setting-up-multiple-iis-application-request-routing-farms-on-the-same-server/sumiarrfarms_6_2.jpg" style="max-height: 250px"/></a></div></div>

<p>Note that this’ll only load CNN and Bing correctly as several of the other domains only listen to their configured domains (IIS ARR will proxy the reuqest onto the origin servers with a hostname request of search &amp; news.local respectfully). I’ll follow up on how to fix that later on.</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Jun</span>
			<span class="day">07</span>
		</div>
		<div class="lower">2010</div>
	</div>

	<div class="title">
		<h1><a href="/bundling-image-requests-for-increased-performance/" title="Bundling Image Requests for Increased Performance" rel="bookmark">Bundling Image Requests for Increased Performance</a></h1>
		<div class="categories">
			
				<a href="http://improve.dk/category/.NET/">.NET</a>
				, 
			
				<a href="http://improve.dk/category/AS/Flex/Flash/">AS/Flex/Flash</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>A common scenario in RIA’s is to show a large amount of small pictures on a single page. Let’s say we want to show 100 images in a grid. While the simplest approach is to just put in 100 image objects and load in the images one by one, I believe it can be done smarter…</p>
<a id="more"></a>

<h2 id="The_cost_of_a_request">The cost of a request</h2>
<p>Each and every request will have a header overhead of about ~400 bytes outgoing and ~200 bytes ingoing - both varying depending on the host, cookies, headers etc. Multiply that by 100 requests and we’ve got about 60KB of data overhead, just for the headers. Even worse is the actual roundtrip time of sending the packets to the server and getting a reply back; Even with reuse of the connections, there’s a large cost involved.</p>
<h2 id="Bundling_requests">Bundling requests</h2>
<p>Imagine if we could just make a single request to the server - “Hey, please send me these 100 images, ty” - and then we’ll get back a single response containing all the images. One way of doing this would be to zip the images on the server and then unzip them on the client - there’s open zip libraries for both Silverlight and Flash. However, this has a large CPU cost on not only the server, but also on the client. Furthermore, images usually don’t compress much so it’s basically just a waste. In this post I’ll present a C# class for bundling images as well as an AS3 class for reading the bundled image stream. While the RIA sample is in Actionscript, it’s easily applicable to Silverlight as well - should anyone feel like implementing the client side in Silverlight, please let me know so I can link you.</p>
<h2 id="Generating_sample_images">Generating sample images</h2>
<p>Our first task is to generate some sample images. The following code will create 100 images named 1-100.jpg containing the greytones from #000000 (well, almost) to #FFFFFF.</p>
<figure class="highlight csharp"><pre><span class="keyword">for</span>(<span class="built_in">int</span> i=<span class="number">1</span>; i&lt;=<span class="number">100</span>; i++)
{
    <span class="built_in">int</span> <span class="built_in">rgb</span> = Convert.ToInt32(i / <span class="number">100</span>d * <span class="number">255</span>);

    using(Bitmap bmp = <span class="keyword">new</span> Bitmap(<span class="number">100</span>, <span class="number">100</span>))
    using(Graphics g = Graphics.FromImage(bmp))
    {
        g.FillRectangle(<span class="keyword">new</span> SolidBrush(Color.FromArgb(<span class="built_in">rgb</span>, <span class="built_in">rgb</span>, <span class="built_in">rgb</span>)), <span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);
        bmp.Save(i + <span class="string">".jpg"</span>);
    }
}
</pre></figure>

<h2 id="On_the_server_side:_ImageStream-cs">On the server side: ImageStream.cs</h2>
<p>The ImageStream class contains a dictionary that’ll hold references to the files untill we’re ready to write them out. Each added file consists of a key as well as a filepath. To keep things simple, I’m limiting the key names to ASCII codes between 32 and 126 to avoid unprintable characters.</p>
<p>The class has a Write method that’ll write all the added images to the provided stream. Each image consists of four parts:</p>
<ul>
<li>4 bytes (int) that contains the combined length of the key and payload plus two extra bytes for specifying the key length.</li>
<li>2 bytes (short) that contains the key length.</li>
<li>X bytes containing the key using UTF8Encoding. I’ll explain later why I’m using UTF8Encoding and not ASCIIEncoding.</li>
<li>X bytes containing the actual file contents.</li>
</ul>
<h3 id="ImageStream-cs">ImageStream.cs</h3>
<figure class="highlight csharp"><pre><span class="keyword">public</span> <span class="keyword">class</span> ImageStream
{
    IDictionary files = <span class="keyword">new</span> Dictionary();

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddFile</span>(<span class="keyword">string</span> key, <span class="keyword">string</span> filePath)
    {
        files.Add(key, <span class="keyword">new</span> FileInfo(filePath));

        <span class="keyword">if</span> (key.ToCharArray().Any(x =&gt; x &lt; <span class="number">32</span> || x &gt; <span class="number">126</span>))
            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(<span class="string">"Invalid character used in key."</span>);
    }

    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Write</span>(Stream stream)
    {
        <span class="comment">// For each file, write the contents</span>
        <span class="keyword">foreach</span> (<span class="keyword">var</span> file <span class="keyword">in</span> files)
        {
            <span class="comment">// Write payload length</span>
            stream.Write(BitConverter.GetBytes((<span class="keyword">int</span>)file.Value.Length + file.Key.Length), <span class="number">0</span>, <span class="number">4</span>);

            <span class="comment">// Write key length</span>
            stream.Write(BitConverter.GetBytes((<span class="keyword">ushort</span>)file.Key.Length), <span class="number">0</span>, <span class="number">2</span>);

            <span class="comment">// Write key</span>
            stream.Write(Encoding.UTF8.GetBytes(file.Key), <span class="number">0</span>, file.Key.Length);

            <span class="comment">// Write file</span>
            stream.Write(File.ReadAllBytes(file.Value.FullName), <span class="number">0</span>, (<span class="keyword">int</span>)file.Value.Length);
        }
    }
}
</pre></figure>

<h2 id="On_the_server_side:_Image-ashx">On the server side: Image.ashx</h2>
<p>All we need now is a file to serve the ImageStream. I’m using an HttpHandler called Image.ashx to loop through all the files (located in “/Imgs/“) and add them to the ImageStream before writing them out to the output stream.</p>
<h3 id="Image-ashx">Image.ashx</h3>
<figure class="highlight csharp"><pre><span class="keyword">public</span> <span class="keyword">class</span> Image : IHttpHandler
{
    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ProcessRequest</span>(HttpContext context)
    {
        context.Response.ContentType = <span class="string">"application/octet-stream"</span>;
        context.Response.Buffer = <span class="keyword">false</span>;

        <span class="keyword">var</span> imgc = <span class="keyword">new</span> ImageStream();

        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>; i&lt;=<span class="number">100</span>; i++)
            imgc.AddFile(<span class="string">"img"</span> + i, context.Server.MapPath(<span class="string">"Imgs/"</span> + i + <span class="string">".jpg"</span>));

        imgc.Write(context.Response.OutputStream);
    }

    <span class="keyword">public</span> <span class="keyword">bool</span> IsReusable
    {
        <span class="keyword">get</span> { <span class="keyword">return</span> <span class="keyword">true</span>; }
    }
}
</pre></figure>

<h2 id="On_the_client_side:_CombinedFileReader-as">On the client side: CombinedFileReader.as</h2>
<p>The CombinedFileReader class takes a url in the constructor, pointing to the stream we want to retrieve. Once we call load() we spawn a URLStream and listen for the PROGRESS and COMPLETE events. The core of the class is the onProgress method, being invoked on both PROGRESS and COMPLETE events. We don’t really care which event it is as both means there’s new data for us to consume.</p>
<p>The onProgress method works as a simple state machine. This could be done much cleaner by abstracting away the state functionality, but it’s simple enough to be easily understood. There are just two states we can be in:</p>
<h3 id="header">header</h3>
<p>In this state we’re currently waiting for there to be 4 bytes available, meaning we can read the first integer containing the number of bytes required to load the current file. Once this has been loaded into the currentFileLength variable, we change the state to “payload”.</p>
<h3 id="payload">payload</h3>
<p>In this state we’re waiting for the remaining bytes to be available. As soon as they become available, we read the key using the readUTF() method on the URLStream class. readUTF automatically reads a short first and expects these two bytes to contain the length of the string to be read in UTF format - thus the use of UTF8Encoding over ASCIIEncoding. As both encodings take up the same amount of bytes, it’s purely a matter of convenience. After this we read in the payload - the image. It’s important to explicitly set the ByteArray endianness to avoid problems since the ByteArray by default uses little endian while our ImageStream uses big endian. Note that the header bytes contains the combined length of the key + payload, thus we should only read in currentFileLength - currentKey.length bytes. Finally we dispatch a custom FileReadEvent (see code further down) taking in the key and payload bytes as parameters.</p>
<h3 id="CombinedFileReader-as">CombinedFileReader.as</h3>
<figure class="highlight actionscript"><pre><span class="package"><span class="keyword">package</span> <span class="title">dk</span>.<span class="title">improve</span>.<span class="title">net</span>
{</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.events.*;</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.net.*;</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.utils.*;</span>

    <span class="preprocessor"><span class="keyword">import</span> mx.events.FlexEvent;</span>

    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CombinedFileReader</span> <span class="keyword">extends</span> <span class="title">EventDispatcher</span>
    {</span>
        <span class="keyword">private</span> <span class="keyword">var</span> url:String;
        <span class="keyword">private</span> <span class="keyword">var</span> urlStream:URLStream;
        <span class="keyword">private</span> <span class="keyword">var</span> currentState:String = <span class="string">"header"</span>;
        <span class="keyword">private</span> <span class="keyword">var</span> currentFileLength:int;
        <span class="keyword">private</span> <span class="keyword">var</span> currentKey:String;

        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">CombinedFileReader</span><span class="params">(url:String)</span>
        {</span>
            <span class="keyword">this</span>.url = url;
        }

        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">()</span><span class="type">:void</span>
        {</span>
            urlStream = <span class="keyword">new</span> URLStream();
            urlStream.endian = Endian.LITTLE_ENDIAN;
            urlStream.addEventListener(ProgressEvent.PROGRESS, onProgress);
            urlStream.addEventListener(Event.COMPLETE, onProgress);
            urlStream.load(<span class="keyword">new</span> URLRequest(url));
        }

        <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">onProgress</span><span class="params">(evt:Event)</span><span class="type">:void</span>
        {</span>
            <span class="keyword">switch</span>(currentState)
            {
                <span class="keyword">case</span> <span class="string">"header"</span>:
                    <span class="keyword">if</span>(urlStream.bytesAvailable &gt;= <span class="number">4</span>)
                    {
                        currentFileLength = urlStream.readInt();
                        currentState = <span class="string">"payload"</span>;

                        onProgress(evt);
                    }
                    <span class="keyword">break</span>;

                <span class="keyword">case</span> <span class="string">"payload"</span>:
                    <span class="keyword">if</span>(urlStream.bytesAvailable &gt;= currentFileLength)
                    {
                        currentKey = urlStream.readUTF();
                        <span class="keyword">var</span> payloadLength = currentFileLength - currentKey.length;

                        <span class="keyword">var</span> bytes:ByteArray = <span class="keyword">new</span> ByteArray();
                        bytes.endian = Endian.BIG_ENDIAN;
                        urlStream.readBytes(bytes, <span class="number">0</span>, payloadLength);

                        dispatchEvent(<span class="keyword">new</span> FileReadEvent(FileReadEvent.ON_LOADED, currentKey, bytes));

                        currentState = <span class="string">"header"</span>;

                        onProgress(evt);
                    }
                    <span class="keyword">break</span>;
            }
        }
    }
}
</pre></figure>

<h3 id="FileReadEvent-as">FileReadEvent.as</h3>
<figure class="highlight actionscript"><pre><span class="package"><span class="keyword">package</span> <span class="title">dk</span>.<span class="title">improve</span>.<span class="title">net</span>
{</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.events.Event;</span>
    <span class="preprocessor"><span class="keyword">import</span> flash.utils.ByteArray;</span>

    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileReadEvent</span> <span class="keyword">extends</span> <span class="title">Event</span>
    {</span>
        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">const</span> ON_LOADED:String = <span class="string">"onLoaded"</span>;
        <span class="keyword">public</span> <span class="keyword">var</span> file:ByteArray;
        <span class="keyword">public</span> <span class="keyword">var</span> key:String;

        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">FileReadEvent</span><span class="params">(type:String, key:String, file:ByteArray)</span><span class="type">:void</span>
        {</span>
            <span class="keyword">this</span>.file = file;
            <span class="keyword">this</span>.key = key;

            <span class="keyword">super</span>(type);
        }
    }
}
</pre></figure>

<h2 id="On_the_client_side:_Thumbnails-mxml">On the client side: Thumbnails.mxml</h2>
<p>The final part of demoing the bundled image stream is to actually consume the stream by using the CombinedFileReader AS3 class. Once the application loads we instantiate a new CombinedFileReader, passing in the url to the Image.ashx HttpHandler I mentioned earlier. Before calling the load() method we subscribe to the ON_LOADED event that’s dispatched by the CombinedFileReader.</p>
<p>Once we’ve read in a file and onFileLoaded() is called, we first need to create a new Loader object and pass the bytes into it using loadBytes(). Before loading the bytes we store a position object in a dictionary. The position object will contain the x &amp; y coordinates for the image once it’s loaded. We can count on the onFileLoaded function to be called in the same order as the images are streamed. Due to the asynchronous nature of loadBytes() the onLoadComplete() function will be called at random times and will thus not be sequential. Once the bytes are loaded in and onLoadComplete is called, we create a new Image, set the source to the loaded content, set the size and coordinate. Finally we add the image to the current application as an element. Note that the images are 100x100px but to conserve space I’m resizing the client side to 50x50px.</p>
<h3 id="Thumbnails-mxml">Thumbnails.mxml</h3>
<figure class="highlight xml"><pre><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="pi">&lt;?xml:namespace prefix = s /&gt;
    &lt;?xml:namespace prefix = fx /&gt;</span>
</pre></figure>

<h2 id="The_result">The result</h2>
<p>If all goes well, the result should look like this:</p>
<div class="imgwrapper" style=""><div><a href="/bundling-image-requests-for-increased-performance/combinedimagereader_1_2.jpg" class="fancy"><img src="/bundling-image-requests-for-increased-performance/combinedimagereader_1_2.jpg" style="max-height: 250px"/></a></div></div>

<div class="imgwrapper" style=""><div><a href="/bundling-image-requests-for-increased-performance/combinedimagereader_2_2.jpg" class="fancy"><img src="/bundling-image-requests-for-increased-performance/combinedimagereader_2_2.jpg" style="max-height: 250px"/></a></div></div>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">23</span>
		</div>
		<div class="lower">2010</div>
	</div>

	<div class="title">
		<h1><a href="/speaking-at-aarhus-dotnet-user-group/" title="Speaking at Aarhus .NET User Group" rel="bookmark">Speaking at Aarhus .NET User Group</a></h1>
		<div class="categories">
			
				<a href="http://improve.dk/category/Conferences and Presenting/">Conferences and Presenting</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>On April 28th I’ll be giving a presentation at <a href="http://www.anug.dk/" target="_blank">Aarhus .NET User Group</a> on SharedCache. The presentation will be part of a combined event where Morten Jokumsen will be presenting Velocity and Jakob Tikjøb Andersen will be presenting Cassandra.</p>
<a id="more"></a>

<p>I’ll give a quick run through of what SharedCache is and what it’s not, how to use it and what you can expect from it. If all goes well, I’ll have my EC2 SharedCache cluster up and running for demo purposes :)</p>
<p>If you want to join, please <a href="http://www.facebook.com/event.php?eid=109698295736298" target="_blank">sign up at Facebook</a>.</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">21</span>
		</div>
		<div class="lower">2010</div>
	</div>

	<div class="title">
		<h1><a href="/simple-as3-stack-implementation/" title="Simple AS3 Stack Implementation" rel="bookmark">Simple AS3 Stack Implementation</a></h1>
		<div class="categories">
			
				<a href="http://improve.dk/category/AS/Flex/Flash/">AS/Flex/Flash</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Recently I was doing some experimental AS3 development. Much to my surprise, simple collection classes like Stack/Queue are not available in the framework - guess I’m spoiled being used to the .NET Framework.</p>
<a id="more"></a>

<p>I ended up implementing a simple <a href="http://en.wikipedia.org/wiki/Stack_(data_structure" target="_blank">stack</a>) using an internal <a href="http://en.wikipedia.org/wiki/Linked_list" target="_blank">linked list</a>. There’s nothing exciting about the implementation but I thought others might be able to use it, so here it is :)</p>
<h3 id="StackNode-as">StackNode.as</h3>
<figure class="highlight actionscript"><pre><span class="package"><span class="keyword">package</span> <span class="title">dk</span>.<span class="title">improve</span>.<span class="title">collections</span>
{</span>
    <span class="keyword">internal</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">StackNode</span>
    {</span>
        <span class="keyword">public</span> <span class="keyword">var</span> value:Object;
        <span class="keyword">public</span> <span class="keyword">var</span> next:StackNode;

        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">StackNode</span><span class="params">(value:Object)</span><span class="type">:void</span>
        {</span>
            <span class="keyword">this</span>.value = value;
        }
    }
}
</pre></figure>

<h3 id="Stack-as">Stack.as</h3>
<figure class="highlight actionscript"><pre><span class="package"><span class="keyword">package</span> <span class="title">dk</span>.<span class="title">improve</span>.<span class="title">collections</span>
{</span>
    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Stack</span>
    {</span>
        <span class="keyword">private</span> <span class="keyword">var</span> head:StackNode;

        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">push</span><span class="params">(obj:Object)</span><span class="type">:void</span>
        {</span>
            <span class="keyword">var</span> newNode:StackNode = <span class="keyword">new</span> StackNode(obj);

            <span class="keyword">if</span>(head == <span class="literal">null</span>)
                head = newNode;
            <span class="keyword">else</span>
            {
                newNode.next = head;
                head = newNode;
            }
        }

        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">pop</span><span class="params">()</span><span class="type">:Object</span>
        {</span>
            <span class="keyword">if</span>(head != <span class="literal">null</span>)
            {
                <span class="keyword">var</span> result:Object = head.value;
                head = head.next;

                <span class="keyword">return</span> result;
            }
            <span class="keyword">else</span>
                <span class="keyword">return</span> <span class="literal">null</span>;
        }

        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">peek</span><span class="params">()</span><span class="type">:Object</span>
        {</span>
            <span class="keyword">if</span>(head != <span class="literal">null</span>)
                <span class="keyword">return</span> head.value;
            <span class="keyword">else</span>
                <span class="keyword">return</span> <span class="literal">null</span>;
        }
    }
}
</pre></figure>



				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">17</span>
		</div>
		<div class="lower">2010</div>
	</div>

	<div class="title">
		<h1><a href="/miracle-openworld-2010-slides/" title="Miracle OpenWorld 2010 Slides" rel="bookmark">Miracle OpenWorld 2010 Slides</a></h1>
		<div class="categories">
			
				<a href="http://improve.dk/category/Conferences and Presenting/">Conferences and Presenting</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>After getting some well needed sleep following Miracle OpenWorld 2010 and adhering to the we-do-not-use-sleep rule, I’m finally starting to get on top again, though my body still aches all over.</p>
<a id="more"></a>

<p>As promised, you can download the slides from my presentations below.</p>
<p><a href="Dissecting_PDF_Documents_1.pdf">Dissecting_PDF_Documents_1.pdf - Slides</a><br><a href="SQL_Azure_for_DBAs.pdf">SQL_Azure_for_DBAs.pdf - Slides</a></p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Mar</span>
			<span class="day">17</span>
		</div>
		<div class="lower">2010</div>
	</div>

	<div class="title">
		<h1><a href="/speaking-at-miracle-openworld-2010/" title="Speaking at Miracle OpenWorld 2010" rel="bookmark">Speaking at Miracle OpenWorld 2010</a></h1>
		<div class="categories">
			
				<a href="http://improve.dk/category/Conferences and Presenting/">Conferences and Presenting</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>I will be giving two presentations at <a href="http://mow2010.dk/" target="_blank">Miracle OpenWorld 2010</a> in April.</p>
<a id="more"></a>

<h2 id="Working_with_PDF_documents">Working with PDF documents</h2>
<p>In this session he will sharing his experiences with dissecting PDF documents for the iPaper system. We’ll look at various commercial as well as open source tools for reading, editing and rasterizing PDF documents. What are some of the common pitfalls you’ll run into when working with PDF documents and what does a PDF really consist of internally? While some of the tools and libraries can also be used to create PDFs, this session will concentrate on working with existing PDF files.</p>
<h2 id="SQL_Azure_for_DBA’s">SQL Azure for DBA’s</h2>
<p>Will be presenting together with Martin Schmidt from Miracle. Abstract is still in the works. It’s safe to say though that this will be no typical sales pitch - we’ll be looking at what limitations you’ll run into, what happens when you reach the limits of SQL Azure and generally what the sales pitch happily ignores.</p>
<p>I highly recommend going to MOW as this is one of the best DBA &amp; developer conferences with networking and fun being in the high seat! There’s a beach party - what more do you need?</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Feb</span>
			<span class="day">19</span>
		</div>
		<div class="lower">2010</div>
	</div>

	<div class="title">
		<h1><a href="/speaking-at-onug/" title="Speaking at Odense .NET User Group" rel="bookmark">Speaking at Odense .NET User Group</a></h1>
		<div class="categories">
			
				<a href="http://improve.dk/category/Conferences and Presenting/">Conferences and Presenting</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>On March 10th I’ll be giving a presentation at <a href="http://www.onug.dk/" target="_blank">Odense .NET User Group</a> on Scalability &amp; Availability on the Microsoft platform.</p>
<a id="more"></a>

<p>As the session will be in Danish, I’ll be posting a danish abstract:</p>
<p>I denne session kommer vi ind på hvordan man sørger for høj tilgængelighed og skalerbarhed af ASP.NET web applikationer ved brug af flere maskiner opsat som cluster. Hvordan sørger vi for konsistent deling af sessions på tværs af maskiner indenfor et cluster? NLB vil blive demonstreret som clustering teknologi med dets styrker og svagheder. Ligeledes vil den nye IIS7 Application Request Routing extension blive demonstreret og hvordan den kan bruges i samspil med NLB.</p>
<p>If you want to join, please <a href="http://www.linkedin.com/osview/canvas?_ch_page_id=1&amp;_ch_panel_id=1&amp;_ch_app_id=7083120&amp;_applicationId=2000&amp;_ownerId=0&amp;appParams={%22go_to%22:%22events/233429%22,%22referrer%22:%22public%22}" target="_blank">sign up at LinkedIn</a>.</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>


<div class="paging">
	<a href="/page/12/"><div class="past">« Past</div></a>
	<a href="/page/10/"><div class="future">Future »</div></a>
	<div class="clear"></div>
</div>

				</div>
			</div>

			<div id="asides">
				<div class="categories aside">
					<span class="sectiontitle">CATEGORIES</span>
					<ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/category/.NET/">.NET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/AS/Flex/Flash/">AS/Flex/Flash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Amazon Web Services/">Amazon Web Services</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Computer Science/">Computer Science</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Conferences and Presenting/">Conferences and Presenting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/IIS/">IIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Life/">Life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Miscellaneous/">Miscellaneous</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Performance/">Performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Poker/">Poker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server/">SQL Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Community/">SQL Server - Community</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Data Types/">SQL Server - Data Types</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Internals/">SQL Server - Internals</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Optimization/">SQL Server - Optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - OrcaMDF/">SQL Server - OrcaMDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Tricks/">SQL Server - Tricks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Testing/">Testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Tools of the Trade/">Tools of the Trade</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Umbraco/">Umbraco</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Visual Studio/">Visual Studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Web/">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Windbg/">Windbg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Windows/">Windows</a></li></ul>

					
				</div>

				<div class="archive aside">
					<span class="sectiontitle">ARCHIVE</span>
					<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archive/2014">2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2013">2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2012">2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2011">2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2010">2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2009">2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2008">2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2007">2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2006">2006</a></li></ul>
				</div>
			</div>

			<div class="clear"></div>
		</div>
		
		<footer>
			<div class="wrapper">Copyright &copy; 2014 Mark S. Rasmussen</div>
		</footer>

		<script type="text/javascript">
			$(function () {
				// Show mobile menu
				$("li.navicon").click(function () {
					if ($("header ul.mobile a").length == 0) {
						// Pages
						$mobilePages = $("div#naviconcontent ul.pages");
						$("header nav ul.normal > li").not(".navicon").each(function (i, el) {
							$mobilePages.append($(el).clone());
						});

						// Categories
						$mobileCategories = $("div#naviconcontent ul.categories");
						$("div#asides div.categories > ul > li").each(function (i, el) {
							$mobileCategories.append($(el).clone());
						});

						// Archive
						$mobileArchive = $("div#naviconcontent ul.archive");
						$("div#asides div.archive > ul > li").each(function (i, el) {
							$mobileArchive.append($(el).clone());
						});
					};

					$("header ul.mobile").toggle();
				});

				// Fancybox setup
				$("a.fancy").fancybox({
					hideOnContentClick: true,
					overlayShow: true
				});
			});
		</script>
	</body>
</html>