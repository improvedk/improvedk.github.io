<!DOCTYPE html>
<html>
	

<head>
	<title>Mark S. Rasmussen</title>
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
	<meta charset="UTF-8" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="website" />
	<meta name="google-site-verification" content="alt7-wfK3ZujMQ4D0jYNd0yC5LGetGdqBlBmZsqQlVw" />
	<link rel="alternative" href="http://feeds.feedburner.com/Improvedk" title="Mark S. Rasmussen" type="application/atom+xml">
	<script src="/js/combined.js"></script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-2479580-1', 'improve.dk');
		ga('send', 	'pageview');
	</script>
	<link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
	<body>
		<div id="headerline"></div>
	
		<header>
			<div class="wrapper">
				<div id="title">
					<a href="/">Mark S. Rasmussen</a> <span>improve.dk</span>
				</div>
				
				<nav>
					<ul class="normal">
						<li class="navicon"><img src="/img/navicon.png" /></li>
						<li><a href="/about-me/">About Me</a></li>
					</ul>
				</nav>
				
				<ul id="sharing">
					<li><a href="mailto:mark@improve.dk"><img src="/img/at.png" /></a></li>
					<li><a href="http://feeds.feedburner.com/Improvedk" id="rssfeed"><img src="/img/rss.png" /></a></li>
					<li><a href="https://twitter.com/improvedk"><img src="/img/twitter.png" /></a></li>
					<li><a href="https://github.com/improvedk"><img src="/img/github.png" /></a></li>
					<li><a href="https://www.linkedin.com/in/markrasmussen/"><img src="/img/linkedin.png" /></a></li>
				</ul>

				<div class="clear"></div>
				
				<div id="naviconcontent">
					<ul class="mobile">
						<li>
							Pages
							<ul class="pages"></ul>
						</li>
						<li>
							Categories
							<ul class="categories"></ul>
						</li>
						<li>
							Archive
							<ul class="archive"></ul>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div id="mainwrapper">
			<div id="contentwrapper">
				<div id="content">
				
					
	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">May</span>
			<span class="day">11</span>
		</div>
		<div class="lower">2012</div>
	</div>

	<div class="title">
		<h1><a href="/2012-community-amp-demo-day-materials/" title="2012 Community &amp; Demo Day Materials" rel="bookmark">2012 Community &amp; Demo Day Materials</a></h1>
		<div class="categories">
			
				<a href="/category/Conferences and Presenting/">Conferences and Presenting</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Yesterday I presented at <a href="http://communityday2012.c1preprod01.composite.net/Community-Day" target="_blank">Community Day</a>. As promised, you can download my slide deck here:</p>
<a id="more"></a>

<p><a href="2012-05-10-CommunityDay-Using-Amazon-S3-CloudFront-for-Scalable-and-Secure-Distribution.rar">CommunityDay-Using-Amazon-S3-CloudFront-for-Scalable-and-Secure-Distribution.rar - Slides</a></p>
<p>I also did a demo of OrcaMDF for the following Demo Day happening. You can find more on OrcaMDF here:</p>
<p><a href="https://github.com/improvedk/OrcaMDF" target="_blank">Git repository</a></p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">23</span>
		</div>
		<div class="lower">2012</div>
	</div>

	<div class="title">
		<h1><a href="/materials-for-my-miracle-open-world-2012-presentation/" title="Materials For My Miracle Open World 2012 Presentation" rel="bookmark">Materials For My Miracle Open World 2012 Presentation</a></h1>
		<div class="categories">
			
				<a href="/category/Conferences and Presenting/">Conferences and Presenting</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Last Thursday I did a full-day presentation at Miracle Open World 2012 on the SQL Server storage engine and MDF file internals.</p>
<p>As mentioned in the session, I usually don’t post my precon slidedeck and materials publicly. If you attended the session, please send me an email at <a href="mailto:mark@improve.dk">mark@improve.dk</a> and I’ll send you the slides + demos for my session :)</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Apr</span>
			<span class="day">02</span>
		</div>
		<div class="lower">2012</div>
	</div>

	<div class="title">
		<h1><a href="/sqlbits-x-slides-demos/" title="SQLBits X Slides + Demos" rel="bookmark">SQLBits X Slides + Demos</a></h1>
		<div class="categories">
			
				<a href="/category/Conferences and Presenting/">Conferences and Presenting</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>As usual, I had a wonderful time at SQLBits X in London. Unfortunately I didn’t arrive until late Friday afternoon since I was flying in at the last minute from SQLConnections. I did however make it to the fabulous party and managed to get in bed early enough so I could be ready for my presentation on Saturday.</p>
<a id="more"></a>

<div class="imgwrapper" style=""><div><a href="/sqlbits-x-slides-demos/2012-03-31-12.00.43_2.jpg" class="fancy"><img src="/sqlbits-x-slides-demos/2012-03-31-12.00.43_2.jpg" style="max-height: 250px"/></a></div></div>

<p>As promised in my session, here are the downloadable slides and demos: [</a></p>
<p><a href="sqlbits_2012_04_01_revealing_the_magic.rar">sqlbits_2012_04_01_revealing_the_magic.rar - Slides &amp; demos</a></p>
<p>All of you who showed up, or wanted to showed up but couldn’t get in, thank you! Also, a big thanks goes out to the SQLBits crew – I can’t say how impressed I am by the tightness with which it’s run. Everything was timed to perfection, the hardware was running excellently and I didn’t see a room without a helper ready to jump in if anyone needed anything.</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Mar</span>
			<span class="day">29</span>
		</div>
		<div class="lower">2012</div>
	</div>

	<div class="title">
		<h1><a href="/sqlconnections-slides-demos/" title="SQLConnections Slides + Demos" rel="bookmark">SQLConnections Slides + Demos</a></h1>
		<div class="categories">
			
				<a href="/category/Conferences and Presenting/">Conferences and Presenting</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>I presented my “Optimizing Storage and Performance Using Page and Row Compression” presentation today here at SQLConnections. Overall I think it went alright, even though I had to speed up a bit at the end due to lack of time – I really hope I’ll be able to get a 75 minute slot next time :)</p>
<a id="more"></a>

<p>As promised, here are the materials from my session:<br><a href="SQLConnections_2012_03_29_SQL433.rar">SQLConnections_2012_03_29_SQL433.rar - Slides &amp; demos</a></p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Mar</span>
			<span class="day">27</span>
		</div>
		<div class="lower">2012</div>
	</div>

	<div class="title">
		<h1><a href="/speaking-at-ndc/" title="Speaking at NDC" rel="bookmark">Speaking at NDC</a></h1>
		<div class="categories">
			
				<a href="/category/Conferences and Presenting/">Conferences and Presenting</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>Just before departing for SQLConnections in Vegas and SQLBits in London, I got notified that I’ve been selected for two presentations at the Norwegian Developers Conference in Oslo, June 6-8th!</p>
<div class="imgwrapper" style=""><div><a href="/speaking-at-ndc/download_2.jpg" class="fancy"><img src="/speaking-at-ndc/download_2.jpg" style="max-height: 250px"/></a></div></div>

<a id="more"></a>

<p>I’ve never been to NDC before but I’ve heard lots of good stuff, as well as seen various clips from the recorded videos. I’m especially excited to participate in a developer oriented conference, given that I’ve been focusing most of my time on SQL Server dedicated events over the last year. Lots of interesting new people and sessions to see!</p>
<p>As mentioned, I’ll be presenting two sessions:</p>
<h2 id="Revealing_the_SQL_Server_Magic">Revealing the SQL Server Magic</h2>
<p><em>Think SQL Server is magical? You’re right! However, there’s some sense to the magic, and that’s what I’ll show you in this extremely deep dive session.</em></p>
<p><em>Through my work in creating OrcaMDF, an open source parser for SQL Server databases, I’ve learned a lot of internal details for the SQL Server database file format. In this session, I will walk you through the internal storage format of MDF files, how we might go about parsing a complete database ourselves, using nothing but a hex editor.</em></p>
<p><em>I will cover how SQL Server stores its own internal metadata about objects, how it knows where to find your data on disk, and once it finds it, how to read it. Using the knowledge from this session, you’ll get a solid understanding of the basics behind SQL Server storage.</em></p>
<p>This is the same session that I’ll be presenting at SQLBits next Saturday. However, given the audience I will be modifying the session to focus more on the development side of things.</p>
<h2 id="Running_SQL_Server_on_Amazon_EC2">Running SQL Server on Amazon EC2</h2>
<p><em>SQL Azure is awesome, if you’re in the Microsoft cloud. But what are your options if you’re using the Amazon cloud?</em></p>
<p><em>I’ll introduce the available database options at Amazon and segue into setting up SQL Server on EC2 using EBS for storage. While EBS is great, it needs to be handled with care to ensure not only proper performance, but also to avoid the inevitable cloud instability and varying performance metrics.</em></p>
<p><em>How far can we push it, and what are the gotchas you need to be aware of?</em></p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Feb</span>
			<span class="day">29</span>
		</div>
		<div class="lower">2012</div>
	</div>

	<div class="title">
		<h1><a href="/why-use-big-endian-for-compressed-integers/" title="Why Use Big Endian For Compressed Integers?" rel="bookmark">Why Use Big Endian For Compressed Integers?</a></h1>
		<div class="categories">
			
				<a href="/category/SQL Server - Internals/">SQL Server - Internals</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>While implementing compression support for <a href="https://github.com/improvedk/OrcaMDF" target="_blank">OrcaMDF</a>, it stumped me when I discovered that integers (including datetime, money and all other type based on integers) were <a href="/the-anatomy-of-row-amp-page-compressed-integers">stored in big endian</a>. As all other integers are stored in little endian and I couldn’t see why they’d want to change it, I assumed it must’ve been due to using different libraries or something to that extent.</p>
<a id="more"></a>

<p>However, at that time I was only implementing row compression, and thus I didn’t consider the implications endianness would have on page compression. You see, one of the techniques page compression uses to save space is column prefixing. When page compressing a page, SQL Server will look for any common column prefix values (at the byte level, page compression is data type agnostic). The best match for a column prefix will be stored as an overall prefix for the column and all other columns will base their value off of this, only storing the diff.</p>
<p>Let’s take a look at a sample identity column and it’s values, stored in little endian:</p>
<figure class="highlight"><pre><span class="setting">2312398493 = <span class="value"><span class="number">0</span>x9D66D489</span></span>
<span class="setting">2312398494 = <span class="value"><span class="number">0</span>x9E66D489</span></span>
<span class="setting">2312398495 = <span class="value"><span class="number">0</span>x9F66D489</span></span>
<span class="setting">2312398496 = <span class="value"><span class="number">0</span>xA066D489</span></span>
</pre></figure>

<p>In this case, the very first byte (the least significant in little endian) changes for each number and thus there’s no common prefix to use for page compression. If we instead store those same values in big endian, look what we get:</p>
<figure class="highlight"><pre>2312398493 = 0x*<span class="strong">*89D466*</span><span class="strong">*9D
2312398494 = 0x*</span><span class="strong">*89D466*</span><span class="strong">*9E
2312398495 = 0x*</span><span class="strong">*89D466*</span><span class="strong">*9F
2312398496 = 0x*</span><span class="strong">*89D466*</span><span class="strong">*A0</span>
</pre></figure>

<p>Notice how the bolded bytes are all the same now – only the last, and least significant, byte is changed when the number increments. As such, we can now store the values using just two bytes instead of four:</p>
<figure class="highlight"><pre><span class="attribute">Column prefix </span>=<span class="string"> 0x89D4669D</span>
</pre></figure>


<figure class="highlight"><pre><span class="setting">2312398493 =<span class="value"></span></span>
<span class="setting">2312398494 = <span class="value"><span class="number">0</span>x039E</span></span>
<span class="setting">2312398495 = <span class="value"><span class="number">0</span>x039F</span></span>
<span class="setting">2312398496 = <span class="value"><span class="number">0</span>x03A0</span></span>
</pre></figure>

<p>The first column actually takes up zero bytes, as it matches the stored column prefix exactly – a saving of four bytes! All the others store a single byte that identifies how many bytes to use from the stored column prefix (0x03), as well as the differential bytes coming afterwards.</p>
<p>Once you realize why we need to use big endian instead of little endian, it’s so obvious. Without the change of endianness, page compression would be way less effective.</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Feb</span>
			<span class="day">20</span>
		</div>
		<div class="lower">2012</div>
	</div>

	<div class="title">
		<h1><a href="/stop-worrying-about-exhausting-bigints/" title="Stop Worrying About Exhausting Bigints" rel="bookmark">Stop Worrying About Exhausting Bigints</a></h1>
		<div class="categories">
			
				<a href="/category/SQL Server/">SQL Server</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>I’ve done it myself, worried about what to do when I exhausted my bigint identity value. I was worried that part of the LSN being a bigint – what would happen when it ran out? Would it perform an integer overflow? The answer? Worrying about exhausting the range of a bigint is not something you should spend time on. Allow me to elaborate.</p>
<a id="more"></a>

<h2 id="The_log_table">The log table</h2>
<p>Imagine you have a table to which you only add new rows. You never delete rows and thus you can’t reuse previous identity values. Instead of looking at how many rows you can have (9,223,372,036,854,775,807; or 18,446,744,073,709,551,616 if you use the maximum negative value as the seed), let’s take a look at the storage requirements, if you were to actually exhaust the range.</p>
<p>Imagine that each row stores nothing but the bigint – no data at all, only the bigint identity value. The fixed row size can easily be calculated as such: two bytes for the status bits, two bytes for the null bitmap pointer, eight bytes for the bigint value, two bytes for the null bitmap column count and finally a single byte for the null bitmap itself. In total – 15 bytes. On top of that we need to add two bytes for an entry into the record offset array.</p>
<p>On an 8KB page, the header takes up 96 bytes, leaving 8096 bytes for the body, including the record offset array. Weighing in at 17 bytes per record, we can store a total of 476 records per page.</p>
<p>If we theoretically were to max out the positive bigint range, storing all records on disk; storing <em>just the bigint identity column</em> would take up a whopping 9,223,372,036,854,775,807 / 476 * 8KB = 140,985 PB. And this is with a seed value of 1 – you can double that amount if you were to start at the negative max. Seeing as the SQL Server database size limit is 524TB – you should probably worry about that sometime before worrying about running out of bigint seed values.</p>
<h2 id="The_high_transaction/sec_table">The high transaction/sec table</h2>
<p>OK, ok, you don’t store all of the rows, you delete them shortly after they’ve entered the system. Let’s say you never have more than 1000 rows in the table at a time, thus avoiding the storage issue.</p>
<p>If you allocate 1,000,000 new rows every second (deleting the other 999,000 of them), how long would you last?</p>
<p>9,223,372,036,854,775,807 / 1,000,000 / 60 / 60 / 24 / 365 = 292,471 years. Even for atheists, that’s a long time.</p>
<p>OK, ok, that’s not enough. What if you allocated 100,000,000 new rows every second instead?</p>
<p>9,223,372,036,854,775,807 / 100,000,000 / 60 / 60 / 24 / 365 = 2,924 years.</p>
<p>So at 100 million new bigint seed allocations per second, you’d still last almost 3,000 years before running out. And you can double that to 6,000 years if you start from the negative max seed value.</p>
<p>If you do manage to setup a SQL Server system with this kind of tx/sec – I’d love to see it!</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Feb</span>
			<span class="day">17</span>
		</div>
		<div class="lower">2012</div>
	</div>

	<div class="title">
		<h1><a href="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/" title="LINQPad - The Perfect Playground for Amazon Web Services" rel="bookmark">LINQPad - The Perfect Playground for Amazon Web Services</a></h1>
		<div class="categories">
			
				<a href="/category/.NET/">.NET</a>
				, 
			
				<a href="/category/Amazon Web Services/">Amazon Web Services</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>I’ve previously written on <a href="/how-to-set-up-and-serve-private-content-using-s3">why I don’t want to rely on third party GUIs</a> for managing my AWS services. Assuming I’ll be interacting with AWS through the SDK later on, I much prefer doing the initial setup using the SDK as well, to ensure I fully understand what I’ve done. <a href="/how-to-set-up-and-serve-private-content-using-s3">In</a> <a href="/pushing-the-limits-of-amazon-s3-upload-performance">previous</a> <a href="/optimizing-single-instance-amazon-s3-delete-performance">posts</a>, I’ve shown full console application examples on how to use the SDK for various tasks; however, creating a console application project, compiling and running it can be kind of cumbersome, especially if you’re just doing some quick testing or API exploration.</p>
<a id="more"></a>

<h2 id="Enter_LINQPad">Enter LINQPad</h2>
<p>If you haven’t tried <a href="http://www.linqpad.net/" target="_blank">LINQPad</a> out before, go do it now! It’s an awesome scratchpad style application for writing and running C#/VB.NET/F# code, either as a single expression, a set of statements or a full application. There are also various plugins for easily connecting to databases, Azure services and lots more. Probably just a matter of time before someone writes a <a href="http://www.linqpad.net/extensibility.aspx" target="_blank">custom provider</a> for AWS as well.</p>
<h3 id="Getting_started_with_the_AWS_SDK_in_LINQPad">Getting started with the AWS SDK in LINQPad</h3>
<p>First up, you need to <a href="http://aws.amazon.com/sdkfornet/" target="_blank">download</a> and install the AWS SDK. Once installed, open LINQPad and press F4. In the following dialog, click Add…</p>
<div class="imgwrapper" style=""><div><a href="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_2.png" class="fancy"><img src="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_2.png" style="max-height: 250px"/></a></div></div>

<p>You can either browse to the AWSSDK.dll file manually, or you can pick it from the GAC – which would be the easiest option if you’re just doing some quick testing.</p>
<div class="imgwrapper" style=""><div><a href="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_4.png" class="fancy"><img src="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_4.png" style="max-height: 250px"/></a></div></div>

<p>After adding it, as a final step, go to the <em>Additional Namespace Imports</em> tab and add Amazon to the list.</p>
<div class="imgwrapper" style=""><div><a href="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_61.png" class="fancy"><img src="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_61.png" style="max-height: 250px"/></a></div></div>

<h2 id="Discoverability">Discoverability</h2>
<p>There are generally two ways to approach a new and unknown API. You <a href="http://aws.amazon.com/documentation/" target="_blank">could read the documentation</a>, or you could just throw yourself at it, relying on intellisense. Unfortunately the free version of LINQPad does not come with intellisense/auto completion, however, at a price of $39 it’s a bargain.</p>
<div class="imgwrapper" style=""><div><a href="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_121.png" class="fancy"><img src="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_121.png" style="max-height: 250px"/></a></div></div>

<h3 id="Exception_output">Exception output</h3>
<p>Inevitably, you’ll probably run into an exception or two. Take the following piece of code for example; it works perfectly, but I forgot to assign the IAM user access to the bucket I’m trying to interact with (and before you remind me to remove the keys, don’t worry, the IAM user was temporary and no longer exists):</p>
<figure class="highlight csharp"><pre><span class="keyword">var</span> accessKeyID = <span class="string">"AKIAIKB6FI6SSOGGOP7A"</span>;
<span class="keyword">var</span> secretKey = <span class="string">"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"</span>;

<span class="keyword">using</span> (<span class="keyword">var</span> client = AWSClientFactory.CreateAmazonS3Client(accessKeyID, secretKey))
{
	<span class="keyword">var</span> request = <span class="keyword">new</span> Amazon.S3.Model.ListObjectsRequest()
		.WithBucketName(<span class="string">"improve-us.dk"</span>);

	<span class="keyword">using</span> (<span class="keyword">var</span> result = client.ListObjects(request))
	{
		result.Dump();
	}
}
</pre></figure>

<p>What you’ll see is a clear notification saying an exception has occurred, as well as a repeated exception in the output pane:</p>
<div class="imgwrapper" style=""><div><a href="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_141.png" class="fancy"><img src="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_141.png" style="max-height: 250px"/></a></div></div>

<p>But look what happens once we expand the exception:</p>
<div class="imgwrapper" style=""><div><a href="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_161.png" class="fancy"><img src="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_161.png" style="max-height: 250px"/></a></div></div>

<p>We get all of the output! Any object, returned or thrown from the code, will automatically be displayed in the output, and can easily be drilled into.</p>
<h3 id="Dumping_objects">Dumping objects</h3>
<p>In case you’re code neither throws exceptions (by some miracle, in my case) nor returns objects, you can always call the .Dump() extension method on any object. Once I granted the IAM user the correct permissions, result.Dump() was called and the result of the ListObjectsRequest was output:</p>
<div class="imgwrapper" style=""><div><a href="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_181.png" class="fancy"><img src="/linqpad-ndash-the-perfect-playground-for-amazon-web-services/image_181.png" style="max-height: 250px"/></a></div></div>

<p>Once again it’s easy to drill down and see all of the properties of the result.</p>
<h2 id="Conclusion">Conclusion</h2>
<p>Adhering to my original statement of not liking third party GUIs, using tools like LINQPad is an excellent option for easily writing test code, without the added overhead of starting Visual Studio, compiling, running, etc. The output is neatly presented and really helps you to get a feeling for the API.</p>
<p>Just to finish off – LINQPad has plenty of uses besides AWS, this is just one scenario for which I’ve been using it extensively lately. I’m really considering creating a LINQPad provider for <a href="https://github.com/improvedk/OrcaMDF" target="_blank">OrcaMDF</a> as one of my next projects.</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Feb</span>
			<span class="day">13</span>
		</div>
		<div class="lower">2012</div>
	</div>

	<div class="title">
		<h1><a href="/creating-multiplexers-using-logic-gates/" title="Creating Multiplexers Using Logic Gates" rel="bookmark">Creating Multiplexers Using Logic Gates</a></h1>
		<div class="categories">
			
				<a href="/category/Computer Science/">Computer Science</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>So what’s a multiplexer you ask? A multiplexer is an <a href="http://en.wikipedia.org/wiki/Integrated_circuit" target="_blank">integrated circuit</a> that takes a number of inputs and outputs a smaller number of outputs. In this case we’re aiming at creating a 4-to-1 multiplexer. As the name implies, it takes four inputs and outputs exactly one output, determined by a <em>select input</em>. Depending on the number of input lines, one or more select lines may be required. For 2<sup>n</sup> input lines, n select lines are needed. In hardware terms, this is basically the simplest of switches.</p>
<a id="more"></a>

<h2 id="Creating_a_2-to-1_multiplexer">Creating a 2-to-1 multiplexer</h2>
<p>To start out easy, we’ll create a multiplexer taking two inputs and a single selector line. With inputs A and B and select line S, if S is 0, the A input will be the output Z. If S is 1, the B will be the output Z.</p>
<p>The boolean formula for the 2-to-1 multiplexer looks like this:</p>
<figure class="highlight sql"><pre>Z = (A ∧ ¬S) ∨ (B ∧ S)
</pre></figure>

<p>If you’re not used to boolean algebra, it may be easier to see it represented in SQL:</p>
<figure class="highlight sql"><pre><span class="operator"><span class="keyword">SELECT</span> @Z = (A & ~S) | (B & S)</span>
</pre></figure>

<p>By ANDing A and B with NOT S and S respectively, we’re guaranteed that either A or B will be output. Creating the circuit, it looks like this:</p>
<div class="imgwrapper" style=""><div><a href="/creating-multiplexers-using-logic-gates/image_thumb1_2.png" class="fancy"><img src="/creating-multiplexers-using-logic-gates/image_thumb1_2.png" style="max-height: 250px"/></a></div></div>

<p>If we enable both A and B inputs but keep S disabled, we see that the A input is passed all the way through to the Z output:</p>
<div class="imgwrapper" style=""><div><a href="/creating-multiplexers-using-logic-gates/image_thumb3_2.png" class="fancy"><img src="/creating-multiplexers-using-logic-gates/image_thumb3_2.png" style="max-height: 250px"/></a></div></div>

<p>And if we enable the S selector line, B is passed through to Z as the output:</p>
<div class="imgwrapper" style=""><div><a href="/creating-multiplexers-using-logic-gates/image_thumb5_2.png" class="fancy"><img src="/creating-multiplexers-using-logic-gates/image_thumb5_2.png" style="max-height: 250px"/></a></div></div>

<h2 id="Creating_a_4-to-1_multiplexer">Creating a 4-to-1 multiplexer</h2>
<p>Now that we’ve created the simplest of multiplexers, let’s get on with the 4-to-1 multiplexer. Given that we have 2<sup>2</sup> inputs, we need two selector lines. The logic is just as before – combining the two selector lines, we have four different combinations. Each combination will ensure that one of the input lines A-D are passed through as the output Z. The formula looks like this:</p>
<figure class="highlight sql"><pre>Z = (A ∧ ¬S0 ∧ ¬S1) ∨ (B ∧ S0 ∧ ¬S1) ∨ (C ∧ ¬S0 ∧ S1) ∨ (D ∧ S0 ∧ S1)
</pre></figure>

<p>And in SQL:</p>
<figure class="highlight sql"><pre><span class="operator"><span class="keyword">SELECT</span> Z = (A & ~S0 & ~S1) | (B & S0 & ~S1) | (C & ~S0 & S1) | (D & S0 & S1)</span>
</pre></figure>

<p>The circuit is pretty much the same as in the 2-to-1 multiplexer, except we add all four inputs and implement the 4-input boolean formula, with S<sub>0</sub> on top and S<sub>1</sub> on bottom:</p>
<div class="imgwrapper" style=""><div><a href="/creating-multiplexers-using-logic-gates/image_thumb7_2.png" class="fancy"><img src="/creating-multiplexers-using-logic-gates/image_thumb7_2.png" style="max-height: 250px"/></a></div></div>

<p>I’ll spare you a demo of all the states and just show all four inputs activated while the signal value of 0b10 results in C being pass through to Z as the result:</p>
<div class="imgwrapper" style=""><div><a href="/creating-multiplexers-using-logic-gates/image_thumb9_2.png" class="fancy"><img src="/creating-multiplexers-using-logic-gates/image_thumb9_2.png" style="max-height: 250px"/></a></div></div>

<h2 id="Combining_two_4-to-1_multiplexers_into_an_8-to-1_multiplexer">Combining two 4-to-1 multiplexers into an 8-to-1 multiplexer</h2>
<p>I’ll spare you the algebraic logic this time as it follows the same pattern as previously, except it’s starting to become quite verbose. In the following circuit I’ve taken the the exact 4-to-1 multiplexer circuit that we created just before, and turned it into an integrated circuit (just as I converted the 2-to-1 multiplexer into an integrated circuit). I’ve then added 8 inputs, A through H as well as three selector inputs, S0 through S2.</p>
<p>S0 and S1 are passed directly into each of the 4-1 multiplexers, no matter the value of S2. This means both 4-1 multiplexers are completely unaware of S2s existence. However, as the output from each of the 4-1 multiplexers are passed into a 2-1 multiplexer connected to the S2 selector line, S2 determines which of the 4-1 multiplexers get to deliver the output.</p>
<div class="imgwrapper" style=""><div><a href="/creating-multiplexers-using-logic-gates/image_thumb2_2.png" class="fancy"><img src="/creating-multiplexers-using-logic-gates/image_thumb2_2.png" style="max-height: 250px"/></a></div></div>

<p>Here’s an example where S2 defines the output should come from the second (leftmost) 4-1 multiplexer, while the S0 and S1 selector lines defines the input should come from the second input in that multiplexer, meaning input F gets passed through as the result Z.</p>
<div class="imgwrapper" style=""><div><a href="/creating-multiplexers-using-logic-gates/image_thumb4_2.png" class="fancy"><img src="/creating-multiplexers-using-logic-gates/image_thumb4_2.png" style="max-height: 250px"/></a></div></div>

<h2 id="Combining_two_8-to-1_multiplexers_into_a_16-to-1_multiplexer">Combining two 8-to-1 multiplexers into a 16-to-1 multiplexer</h2>
<p>Ok, let’s just stop here.Using the smaller multiplexers we can continue combining them until we reach the desired size.</p>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>

	<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Feb</span>
			<span class="day">07</span>
		</div>
		<div class="lower">2012</div>
	</div>

	<div class="title">
		<h1><a href="/orcamdf-row-compression-support/" title="OrcaMDF Row Compression Support" rel="bookmark">OrcaMDF Row Compression Support</a></h1>
		<div class="categories">
			
				<a href="/category/SQL Server - OrcaMDF/">SQL Server - OrcaMDF</a>
				
			
		</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" >

		
		
			<div class="body">
			
				<p>After two months of on and off work, I finally merged the <a href="https://github.com/improvedk/OrcaMDF" target="_blank">OrcaMDF</a> compression branch into master. This means OrcaMDF now officially supports data row compression!</p>
<a id="more"></a>

<h2 id="Supported_data_types">Supported data types</h2>
<p>Implementing row compression required me to modify nearly all existing data types as compression changes the way they’re stored. Integers are <a href="/the-anatomy-of-row-amp-page-compressed-integers">compressed</a>, decimals are <a href="/how-are-vardecimals-stored">variable length</a> and variable length values are generally truncated instead of padded with 0’s. All previous data types implemented in OrcaMDF supports row compression, just as I’ve added a few. The current list of supported data types is as follows:</p>
<ul>
<li>bigint</li>
<li>binary</li>
<li>bit</li>
<li>char</li>
<li>date</li>
<li>datetime</li>
<li>mal/numeric (including vardecimal, both with and without row compression)</li>
<li>image</li>
<li>int</li>
<li>money</li>
<li>nchar</li>
<li>ntext</li>
<li>nvarchar</li>
<li>smallint</li>
<li>smallmoney</li>
<li>text</li>
<li>time</li>
<li>uniqueidentifier</li>
<li>varbinary</li>
<li>varchar</li>
</ul>
<h2 id="Unicode_compression">Unicode compression</h2>
<p>Nchar and nvarchar proved to be slightly more tricky than the rest as they use the <a href="http://unicode.org/reports/tr6/" target="_blank">SCSU</a> unicode compression format. I found a single <a href="http://gautam-m.blogspot.com/2010/09/standard-compression-scheme-for-unicode.html" target="_blank">.NET implementation of SCSU</a>, but while I was allowed to use the code, it didn’t come with a license and that’s a no go when I want to embed it in OrcaMDF. Furthermore had a lot of Java artifacts lying around (relying on goto for instance) that I didn’t fancy. I chose to implement my own SCSU decompression based on the reference implementation provided by Unicode, Inc. I’ve only implemented decompression to end up with a very slim and simple SCSU decompressor.</p>
<p>I’ll be posting a blog on the decompressor itself as it has some value as a standalone class outside of OrcaMDF.</p>
<h2 id="Architecture_changes">Architecture changes</h2>
<p>I started out thinking I’d be able to finish off compression support within a week or two, after all, it was <a href="http://www.amazon.com/Microsoft%C2%AE-SQL-Server%C2%AE-2008-Internals/dp/0735626243" target="_blank">rather well documented</a>. It didn’t take long before it dawned upon me, just how many changes implementing compression would require. The record parser would obviously need to know whether the page was compressed or not. But where would it know that from? Previously all it got was a page pointer, now I had to lookup the compression (which varies by partition) metadata and make sure it was passed along all the way from the DataScanner to the page parser, to the record parser and onwards to the data type parsers.</p>
<p>I’ve had to implement multiple abstractions on top of the regular parsers to abstract away whether the records were stored in a compressed or non compressed format. Overall it’s resulted in a better architecture, but it took a lot more work than expected. Actually parsing the compressed record format was the smallest part of the ordeal – the documentation was spot on and it’s a simple format. The data types however, that took some more work until I had the format figured out.</p>
<h2 id="Taking_it_for_a_spin">Taking it for a spin</h2>
<p>As always, the <a href="https://github.com/improvedk/OrcaMDF" target="_blank">code is available at Github</a>, feel free to take a look! If you’re not the coding type, I’ve also uploaded the <a href="https://github.com/improvedk/OrcaMDF/downloads" target="_blank">binary download</a> (dated 2012-02-06) of the OrcaMDF Studio, a GUI built on top of OrcaMDF.</p>
<h2 id="Stats">Stats</h2>
<p>Being a lover of numbers myself, I love looking at statistics. Here’s a couple of random stats from OrcaMDF:</p>
<ul>
<li>123 commits, the first one being made on April 15th 2011 – that’s almost a year ago!</li>
<li>~11.700 lines of C# code (excluding blanks).</li>
<li>~1000 lines of comments.</li>
<li>~35% of the code is dedicated to testing, with a test suite comprising of over 200 tests.</li>
<li><a href="https://www.ohloh.net/p/OrcaMDF" target="_blank">Ohloh</a> estimates OrcaMDF has a development cost of $144,090 – makes me wonder if not my time would be better spent elsewhere…</li>
</ul>


				<div style="clear: both"></div>

				

			</div>

		

		

	</div>
</article>


<div class="paging">
	<a href="/page/5/"><div class="past">« Past</div></a>
	<a href="/page/3/"><div class="future">Future »</div></a>
	<div class="clear"></div>
</div>

				</div>
			</div>

			<div id="asides">
				<div class="categories aside">
					<span class="sectiontitle">CATEGORIES</span>
					<ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/category/.NET/">.NET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/AS/Flex/Flash/">AS/Flex/Flash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Amazon Web Services/">Amazon Web Services</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Computer Science/">Computer Science</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Conferences and Presenting/">Conferences and Presenting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/IIS/">IIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Life/">Life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Miscellaneous/">Miscellaneous</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Performance/">Performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Poker/">Poker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server/">SQL Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Community/">SQL Server - Community</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Data Types/">SQL Server - Data Types</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Internals/">SQL Server - Internals</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Optimization/">SQL Server - Optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - OrcaMDF/">SQL Server - OrcaMDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Tricks/">SQL Server - Tricks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Testing/">Testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Tools of the Trade/">Tools of the Trade</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Umbraco/">Umbraco</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Visual Studio/">Visual Studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Web/">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Windbg/">Windbg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Windows/">Windows</a></li></ul>

					
				</div>

				<div class="archive aside">
					<span class="sectiontitle">ARCHIVE</span>
					<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archive/2014">2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2013">2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2012">2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2011">2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2010">2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2009">2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2008">2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2007">2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2006">2006</a></li></ul>
				</div>
			</div>

			<div class="clear"></div>
		</div>
		
		<footer>
			<div class="wrapper">Copyright &copy; 2014 Mark S. Rasmussen</div>
		</footer>

		<script type="text/javascript">
			$(function () {
				// Show mobile menu
				$("li.navicon").click(function () {
					if ($("header ul.mobile a").length == 0) {
						// Pages
						$mobilePages = $("div#naviconcontent ul.pages");
						$("header nav ul.normal > li").not(".navicon").each(function (i, el) {
							$mobilePages.append($(el).clone());
						});

						// Categories
						$mobileCategories = $("div#naviconcontent ul.categories");
						$("div#asides div.categories > ul > li").each(function (i, el) {
							$mobileCategories.append($(el).clone());
						});

						// Archive
						$mobileArchive = $("div#naviconcontent ul.archive");
						$("div#asides div.archive > ul > li").each(function (i, el) {
							$mobileArchive.append($(el).clone());
						});
					};

					$("header ul.mobile").toggle();
				});

				// Fancybox setup
				$("a.fancy").fancybox({
					hideOnContentClick: true,
					overlayShow: true
				});
			});
		</script>
	</body>
</html>