<!DOCTYPE html>
<html>
	

<head>
	<title>Creating a Type Aware Parser for the sys.system_internals_partition_columns.ti Field | Mark S. Rasmussen</title>
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0" />
	<meta charset="UTF-8" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="website" />
	<meta name="google-site-verification" content="alt7-wfK3ZujMQ4D0jYNd0yC5LGetGdqBlBmZsqQlVw" />
	<meta content="article" property="og:type">
<meta content="Creating a Type Aware Parser for the sys.system_internals_partition_columns.ti Field" property="og:title">
<meta content="http://improve.dk/creating-a-type-aware-parser-for-the-sys-system_internals_partition_columns-ti-field/" property="og:url">
<meta property="og:image">
<meta content="Mark S. Rasmussen" property="og:site_name">
<meta content="Based on my findings exploring the sys.system_internals_partition_columns.ti field, I needed parser that could extract the scale, precision, max_length as well as the max_inrow_length fields from it." property="og:description">
<meta content="summary" name="twitter:card">
	<link rel="alternative" href="http://feeds.feedburner.com/Improvedk" title="Mark S. Rasmussen" type="application/atom+xml">
	<script src="/js/combined.js"></script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-2479580-1', 'improve.dk');
		ga('require', 'displayfeatures');
		ga('send', 	'pageview');
	</script>
	<link rel="stylesheet" href="/css/style.css" type="text/css" />
</head>
	<body>
		<div id="headerline"></div>
	
		<header>
			<div class="wrapper">
				<div id="title">
					<a href="/">Mark S. Rasmussen</a> <span>improve.dk</span>
				</div>
				
				<nav>
					<ul class="normal">
						<li class="navicon"></li>
						<li><a href="/about-me/">About Me</a></li>
					</ul>
				</nav>
				
				<ul id="sharing">
					<li><a href="mailto:mark@improve.dk" id="shareat"></a></li>
					<li><a href="http://feeds.feedburner.com/Improvedk" id="rssfeed"></a></li>
					<li><a href="https://twitter.com/improvedk" id="sharetwitter"></a></li>
					<li><a href="https://github.com/improvedk" id="sharegithub"></a></li>
					<li><a href="https://www.linkedin.com/in/markrasmussen/" id="sharelinkedin"></a></li>
				</ul>

				<div class="clear"></div>
				
				<div id="naviconcontent">
					<ul class="mobile">
						<li>
							Pages
							<ul class="pages"></ul>
						</li>
						<li>
							Categories
							<ul class="categories"></ul>
						</li>
						<li>
							Archive
							<ul class="archive"></ul>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div id="mainwrapper">
			<div id="contentwrapper">
				<div id="content">
				
					<article>
	<div class="datebox">
		<div class="upper">
			<span class="month">Jul</span>
			<span class="day">13</span>
		</div>
		<div class="lower">2011</div>
	</div>

	<div class="title">
		<h1><a href="/creating-a-type-aware-parser-for-the-sys-system_internals_partition_columns-ti-field/" title="Creating a Type Aware Parser for the sys.system_internals_partition_columns.ti Field" rel="bookmark">Creating a Type Aware Parser for the sys.system_internals_partition_columns.ti Field</a></h1>
		<div class="categories">
			
				<a href="/category/SQL Server - Internals/">SQL Server - Internals</a>
				
			
		</div>
		
			<div class="comments">
				<a href="#comments" title="Comment on Creating a Type Aware Parser for the sys.system_internals_partition_columns.ti Field">Comments</a>
			</div>
		
		<div class="clear"></div>
	</div>

	<div id="bodywrapper" class="single">

		
		
			<div class="body">
			
				<p>Based on my findings <a href="/exploring-the-sys-system_internals_partition_columns-ti-field">exploring the sys.system_internals_partition_columns.ti field</a>, I needed parser that could extract the scale, precision, max_length as well as the max_inrow_length fields from it. The tricky part is that those values are stored differently for each individual type, added onto the fact that some types have hardcoded defaults that are not stored in the ti field, even though there’s space for it.</p>
<a id="more"></a>

<p>As a result of some reverse engineering and empirical testing, I’ve made a SysrscolTIParser class that takes in the ti value (I have no idea what the acronym stands for – type information perhaps?), determines the type and parses it corresponding to the type. I won’t go into details as that’s all described in my <a href="/exploring-the-sys-system_internals_partition_columns-ti-field">previous post</a>.</p>
<figure class="highlight cs"><pre><span class="keyword">using</span> System;
<span class="keyword">using</span> OrcaMDF.Core.MetaData.Enumerations;

namespace OrcaMDF.Core.MetaData
{
	<span class="keyword">public</span> <span class="keyword">class</span> SysrscolTIParser
	{
		<span class="keyword">public</span> <span class="keyword">byte</span> Scale;
		<span class="keyword">public</span> <span class="keyword">byte</span> Precision;
		<span class="keyword">public</span> <span class="keyword">short</span> MaxLength;
		<span class="keyword">public</span> <span class="keyword">short</span> MaxInrowLength;
		<span class="keyword">public</span> <span class="keyword">int</span> TypeID;

		<span class="keyword">public</span> <span class="title">SysrscolTIParser</span>(<span class="keyword">int</span> ti)
		{
			TypeID = ti & <span class="number">0xFF</span>;

			<span class="keyword">if</span> (!Enum.IsDefined(<span class="keyword">typeof</span>(SystemType), TypeID))
				<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(<span class="string">"Unknown TypeID '"</span> + TypeID + <span class="string">"'"</span>);

			<span class="keyword">switch</span>((SystemType)TypeID)
			{
				<span class="keyword">case</span> SystemType.Bigint:
					MaxLength = MaxInrowLength = <span class="number">8</span>;
					Precision = <span class="number">19</span>;
					<span class="keyword">break</span>;

				<span class="comment">// All CLR types internally stored as varbinaries</span>
				<span class="comment">//case SystemType.Geography:</span>
				<span class="comment">//case SystemType.Geometry:</span>
				<span class="comment">//case SystemType.Hierarchyid:</span>
				<span class="keyword">case</span> SystemType.Varbinary:
				<span class="comment">// Also covers SystemType.Sysname</span>
				<span class="keyword">case</span> SystemType.Nvarchar:
				<span class="keyword">case</span> SystemType.Binary:
				<span class="keyword">case</span> SystemType.Char:
				<span class="keyword">case</span> SystemType.Nchar:
				<span class="keyword">case</span> SystemType.Image:
				<span class="keyword">case</span> SystemType.Ntext:
				<span class="keyword">case</span> SystemType.Text:
				<span class="keyword">case</span> SystemType.Varchar:
				<span class="keyword">case</span> SystemType.Xml:
					MaxLength = (<span class="keyword">short</span>)((ti & <span class="number">0xFFFF00</span>) &gt;&gt; <span class="number">8</span>);
					<span class="keyword">if</span> (MaxLength == <span class="number">0</span>)
					{
						MaxLength = -<span class="number">1</span>;
						MaxInrowLength = <span class="number">8000</span>;
					}
					<span class="keyword">else</span>
						MaxInrowLength = MaxLength;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Bit:
					MaxLength = MaxInrowLength = Precision = <span class="number">1</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Date:
					Precision = <span class="number">10</span>;
					MaxLength = MaxInrowLength = <span class="number">3</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Datetime:
					Scale = <span class="number">3</span>;
					Precision = <span class="number">23</span>;
					MaxLength = MaxInrowLength = <span class="number">8</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Datetime2:
					Scale = (<span class="keyword">byte</span>)((ti & <span class="number">0xFF00</span>) &gt;&gt; <span class="number">8</span>);
					Precision = (<span class="keyword">byte</span>)(<span class="number">20</span> + Scale);
					<span class="keyword">if</span> (Scale &lt; <span class="number">3</span>)
						MaxLength = MaxInrowLength = <span class="number">6</span>;
					<span class="keyword">else</span> <span class="keyword">if</span> (Scale &lt; <span class="number">5</span>)
						MaxLength = MaxInrowLength = <span class="number">7</span>;
					<span class="keyword">else</span>
						MaxLength = MaxInrowLength = <span class="number">8</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.DatetimeOffset:
					Scale = (<span class="keyword">byte</span>)((ti & <span class="number">0xFF00</span>) &gt;&gt; <span class="number">8</span>);
					Precision = (<span class="keyword">byte</span>)(<span class="number">26</span> + (Scale &gt; <span class="number">0</span> ? Scale + <span class="number">1</span> : Scale));
					<span class="keyword">if</span> (Scale &lt; <span class="number">3</span>)
						MaxLength = MaxInrowLength = <span class="number">8</span>;
					<span class="keyword">else</span> <span class="keyword">if</span> (Scale &lt; <span class="number">5</span>)
						MaxLength = MaxInrowLength = <span class="number">9</span>;
					<span class="keyword">else</span>
						MaxLength = MaxInrowLength = <span class="number">10</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Decimal:
				<span class="keyword">case</span> SystemType.Numeric:
					Precision = (<span class="keyword">byte</span>)((ti & <span class="number">0xFF00</span>) &gt;&gt; <span class="number">8</span>);
					Scale = (<span class="keyword">byte</span>)((ti & <span class="number">0xFF0000</span>) &gt;&gt; <span class="number">16</span>);
					<span class="keyword">if</span> (Precision &lt; <span class="number">10</span>)
						MaxLength = MaxInrowLength = <span class="number">5</span>;
					<span class="keyword">else</span> <span class="keyword">if</span> (Precision &lt; <span class="number">20</span>)
						MaxLength = MaxInrowLength = <span class="number">9</span>;
					<span class="keyword">else</span> <span class="keyword">if</span> (Precision &lt; <span class="number">29</span>)
						MaxLength = MaxInrowLength = <span class="number">13</span>;
					<span class="keyword">else</span>
						MaxLength = MaxInrowLength = <span class="number">17</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Float:
					Precision = <span class="number">53</span>;
					MaxLength = MaxInrowLength = <span class="number">8</span>;
					<span class="keyword">break</span>;
					
				<span class="keyword">case</span> SystemType.Int:
					Precision = <span class="number">10</span>;
					MaxLength = MaxInrowLength = <span class="number">4</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Money:
					Scale = <span class="number">4</span>;
					Precision = <span class="number">19</span>;
					MaxLength = MaxInrowLength = <span class="number">8</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Real:
					Precision = <span class="number">24</span>;
					MaxLength = MaxInrowLength = <span class="number">4</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Smalldatetime:
					Precision = <span class="number">16</span>;
					MaxLength = MaxInrowLength = <span class="number">4</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Smallint:
					Precision = <span class="number">5</span>;
					MaxLength = MaxInrowLength = <span class="number">2</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Smallmoney:
					Scale = <span class="number">4</span>;
					Precision = <span class="number">10</span>;
					MaxLength = MaxInrowLength = <span class="number">4</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Sql_Variant:
					MaxLength = MaxInrowLength = <span class="number">8016</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Time:
					Scale = (<span class="keyword">byte</span>)((ti & <span class="number">0xFF00</span>) &gt;&gt; <span class="number">8</span>);
					Precision = (<span class="keyword">byte</span>)(<span class="number">8</span> + (Scale &gt; <span class="number">0</span> ? Scale + <span class="number">1</span> : Scale));
					<span class="keyword">if</span> (Scale &lt; <span class="number">3</span>)
						MaxLength = MaxInrowLength = <span class="number">3</span>;
					<span class="keyword">else</span> <span class="keyword">if</span> (Scale &lt; <span class="number">5</span>)
						MaxLength = MaxInrowLength = <span class="number">4</span>;
					<span class="keyword">else</span>
						MaxLength = MaxInrowLength = <span class="number">5</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Timestamp:
					MaxLength = MaxInrowLength = <span class="number">8</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Tinyint:
					Precision = <span class="number">3</span>;
					MaxLength = MaxInrowLength = <span class="number">1</span>;
					<span class="keyword">break</span>;

				<span class="keyword">case</span> SystemType.Uniqueidentifier:
					MaxLength = MaxInrowLength = <span class="number">16</span>;
					<span class="keyword">break</span>;

				<span class="keyword">default</span>:
					<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(<span class="string">"TypeID '"</span> + TypeID + <span class="string">"' not supported."</span>);
			}
		}
	}
}
</pre></figure>

<p>It uses a SystemType enumeration for switching between the types (sorry, formatting isn’t being nice to me here):</p>
<figure class="highlight cs"><pre>namespace OrcaMDF.Core.MetaData.Enumerations
{
	<span class="keyword">public</span> <span class="keyword">enum</span> SystemType
	{
		Image				= <span class="number">34</span>,
		Text				= <span class="number">35</span>,
		Uniqueidentifier		= <span class="number">36</span>,
		Date				= <span class="number">40</span>,
		Time				= <span class="number">41</span>,
		Datetime2			= <span class="number">42</span>,
		DatetimeOffset			= <span class="number">43</span>,
		Tinyint				= <span class="number">48</span>,
		Smallint			= <span class="number">52</span>,
		Int				= <span class="number">56</span>,
		Smalldatetime			= <span class="number">58</span>,
		Real				= <span class="number">59</span>,
		Money				= <span class="number">60</span>,
		Datetime			= <span class="number">61</span>,
		Float				= <span class="number">62</span>,
		Sql_Variant			= <span class="number">98</span>,
		Ntext				= <span class="number">99</span>,
		Bit				= <span class="number">104</span>,
		Decimal				= <span class="number">106</span>,
		Numeric				= <span class="number">108</span>,
		Smallmoney			= <span class="number">122</span>,
		Bigint				= <span class="number">127</span>,
		Hierarchyid			= <span class="number">240</span>,
		Geometry			= <span class="number">240</span>,
		Geography			= <span class="number">240</span>,
		Varbinary			= <span class="number">165</span>,
		Varchar				= <span class="number">167</span>,
		Binary				= <span class="number">173</span>,
		Char				= <span class="number">175</span>,
		Timestamp			= <span class="number">189</span>,
		Nvarchar			= <span class="number">231</span>,
		Nchar				= <span class="number">239</span>,
		Xml				= <span class="number">241</span>,
		Sysname				= <span class="number">231</span>
	}
}
</pre></figure>

<p>And last, but not least, a bunch of tests to verify the functionality:</p>
<figure class="highlight cs"><pre><span class="keyword">using</span> NUnit.Framework;
<span class="keyword">using</span> OrcaMDF.Core.MetaData;

namespace OrcaMDF.Core.Tests.MetaData
{
	[TestFixture]
	<span class="keyword">public</span> <span class="keyword">class</span> SysrscolTIParserTests
	{
		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Bigint</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">127</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">19</span>, parser.Precision);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">127</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Binary</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">12973</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">50</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">173</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">50</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Bit</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">104</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">1</span>, parser.Precision);
			Assert.AreEqual(<span class="number">1</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">104</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">1</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Char</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">2735</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">10</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">175</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">10</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Date</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">40</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">10</span>, parser.Precision);
			Assert.AreEqual(<span class="number">3</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">40</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">3</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Datetime</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">61</span>);
			Assert.AreEqual(<span class="number">3</span>, parser.Scale);
			Assert.AreEqual(<span class="number">23</span>, parser.Precision);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">61</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Datetime2</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">1834</span>);
			Assert.AreEqual(<span class="number">7</span>, parser.Scale);
			Assert.AreEqual(<span class="number">27</span>, parser.Precision);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">42</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxInrowLength);

			parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">810</span>);
			Assert.AreEqual(<span class="number">3</span>, parser.Scale);
			Assert.AreEqual(<span class="number">23</span>, parser.Precision);
			Assert.AreEqual(<span class="number">7</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">42</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">7</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Datetimeoffset</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">1835</span>);
			Assert.AreEqual(<span class="number">7</span>, parser.Scale);
			Assert.AreEqual(<span class="number">34</span>, parser.Precision);
			Assert.AreEqual(<span class="number">10</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">43</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">10</span>, parser.MaxInrowLength);

			parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">1067</span>);
			Assert.AreEqual(<span class="number">4</span>, parser.Scale);
			Assert.AreEqual(<span class="number">31</span>, parser.Precision);
			Assert.AreEqual(<span class="number">9</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">43</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">9</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Decimal</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">330858</span>);
			Assert.AreEqual(<span class="number">5</span>, parser.Scale);
			Assert.AreEqual(<span class="number">12</span>, parser.Precision);
			Assert.AreEqual(<span class="number">9</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">106</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">9</span>, parser.MaxInrowLength);

			parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">396138</span>);
			Assert.AreEqual(<span class="number">6</span>, parser.Scale);
			Assert.AreEqual(<span class="number">11</span>, parser.Precision);
			Assert.AreEqual(<span class="number">9</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">106</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">9</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Float</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">62</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">53</span>, parser.Precision);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">62</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Varbinary</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">165</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(-<span class="number">1</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">165</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8000</span>, parser.MaxInrowLength);

			parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">228517</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">892</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">165</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">892</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Image</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">4130</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">16</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">34</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">16</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Int</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">56</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">10</span>, parser.Precision);
			Assert.AreEqual(<span class="number">4</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">56</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">4</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Money</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">60</span>);
			Assert.AreEqual(<span class="number">4</span>, parser.Scale);
			Assert.AreEqual(<span class="number">19</span>, parser.Precision);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">60</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Nchar</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">5359</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">20</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">239</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">20</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Ntext</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">4195</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">16</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">99</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">16</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Numeric</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">265580</span>);
			Assert.AreEqual(<span class="number">4</span>, parser.Scale);
			Assert.AreEqual(<span class="number">13</span>, parser.Precision);
			Assert.AreEqual(<span class="number">9</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">108</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">9</span>, parser.MaxInrowLength);

			parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">135020</span>);
			Assert.AreEqual(<span class="number">2</span>, parser.Scale);
			Assert.AreEqual(<span class="number">15</span>, parser.Precision);
			Assert.AreEqual(<span class="number">9</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">108</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">9</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Nvarchar</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">25831</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">100</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">231</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">100</span>, parser.MaxInrowLength);

			parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">231</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(-<span class="number">1</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">231</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8000</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Real</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">59</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">24</span>, parser.Precision);
			Assert.AreEqual(<span class="number">4</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">59</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">4</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Smalldatetime</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">58</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">16</span>, parser.Precision);
			Assert.AreEqual(<span class="number">4</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">58</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">4</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Smallint</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">52</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">5</span>, parser.Precision);
			Assert.AreEqual(<span class="number">2</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">52</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">2</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Smallmoney</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">122</span>);
			Assert.AreEqual(<span class="number">4</span>, parser.Scale);
			Assert.AreEqual(<span class="number">10</span>, parser.Precision);
			Assert.AreEqual(<span class="number">4</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">122</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">4</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Sql_Variant</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">98</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">8016</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">98</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8016</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Text</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">4131</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">16</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">35</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">16</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Time</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">1833</span>);
			Assert.AreEqual(<span class="number">7</span>, parser.Scale);
			Assert.AreEqual(<span class="number">16</span>, parser.Precision);
			Assert.AreEqual(<span class="number">5</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">41</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">5</span>, parser.MaxInrowLength);

			parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">1065</span>);
			Assert.AreEqual(<span class="number">4</span>, parser.Scale);
			Assert.AreEqual(<span class="number">13</span>, parser.Precision);
			Assert.AreEqual(<span class="number">4</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">41</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">4</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Timestamp</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">189</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">189</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Tinyint</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">48</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">3</span>, parser.Precision);
			Assert.AreEqual(<span class="number">1</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">48</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">1</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Uniqueidentifier</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">36</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">16</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">36</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">16</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Varchar</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">12967</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(<span class="number">50</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">167</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">50</span>, parser.MaxInrowLength);

			parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">167</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(-<span class="number">1</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">167</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8000</span>, parser.MaxInrowLength);
		}

		[Test]
		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Xml</span>()
		{
			<span class="keyword">var</span> parser = <span class="keyword">new</span> SysrscolTIParser(<span class="number">241</span>);
			Assert.AreEqual(<span class="number">0</span>, parser.Scale);
			Assert.AreEqual(<span class="number">0</span>, parser.Precision);
			Assert.AreEqual(-<span class="number">1</span>, parser.MaxLength);
			Assert.AreEqual(<span class="number">241</span>, parser.TypeID);
			Assert.AreEqual(<span class="number">8000</span>, parser.MaxInrowLength);
		}
	}
}
</pre></figure>

<p>All of this is just one big giant bit of infrastructure I needed to implement to get my scanning of nonclustered indexes working. As soon as I’ve got that up and running, all of this, plus a lot more, will be committed &amp; pushed to the <a href="https://github.com/improvedk/OrcaMDF" target="_blank">OrcaMDF repo</a>.</p>


				<div style="clear: both"></div>

				
					<div id="postsharing">
						<a href="https://twitter.com/home?status=Creating%20a%20Type%20Aware%20Parser%20for%20the%20sys.system_internals_partition_columns.ti%20Field%20http%3A%2F%2Fimprove.dk%2Fcreating-a-type-aware-parser-for-the-sys-system_internals_partition_columns-ti-field%2F%20via%20%40improvedk" target="_blank" class="twitter"></a>
						<a href="https://www.facebook.com/sharer.php?u=http%3A%2F%2Fimprove.dk%2Fcreating-a-type-aware-parser-for-the-sys-system_internals_partition_columns-ti-field%2F" target="_blank" class="facebook"></a>
						<a href="http://reddit.com/submit?url=http%3A%2F%2Fimprove.dk%2Fcreating-a-type-aware-parser-for-the-sys-system_internals_partition_columns-ti-field%2F&title=Creating%20a%20Type%20Aware%20Parser%20for%20the%20sys.system_internals_partition_columns.ti%20Field" target="_blank" class="reddit"></a>
						<a href="https://github.com/improvedk/improve.dk/blob/master/source/_posts/creating-a-type-aware-parser-for-the-sys-system_internals_partition_columns-ti-field/creating-a-type-aware-parser-for-the-sys-system_internals_partition_columns-ti-field.md" target="_blank" title="View source" class="github"></a>
					</div>

					<div id="bio">
						<div class="avatar"></div>
						<div class="wrapper">
							<div class="name">Mark S. Rasmussen</div>
							<div class="description">
								I'm the CTO at <a href="http://www.ipaper-cms.com/">iPaper</a> where I cuddle with databases, mold code and maintain the overall technical &amp; team responsibility. I'm an avid speaker at user groups &amp; conferences. I love life, motorcycles, photography and all things technical. Say hi on <a href="http://twitter.com/improvedk">Twitter</a>, write me an <a href="mailto:mark@improve.dk">email</a> or look me up on <a href="http://dk.linkedin.com/in/markrasmussen/">LinkedIn</a>.
							</div>
						</div>
						<div class="clear"></div>
					</div>
				

			</div>

		

		
			<a name="comments"></a>
<div id="disqus_thread"></div>
<script type="text/javascript">
	var disqus_shortname = 'improvedk';
	var disqus_identifier = 'creating-a-type-aware-parser-for-the-sys-system_internals_partition_columns-ti-field';
	var disqus_url = 'http://improve.dk/creating-a-type-aware-parser-for-the-sys-system_internals_partition_columns-ti-field/';

	(function() {
		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
		

	</div>
</article>

				</div>
			</div>

			<div id="asides">
				<div class="categories aside">
					<span class="sectiontitle">CATEGORIES</span>
					<ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/category/.NET/">.NET</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/AS/Flex/Flash/">AS/Flex/Flash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Amazon Web Services/">Amazon Web Services</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Computer Science/">Computer Science</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Conferences and Presenting/">Conferences and Presenting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/IIS/">IIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Life/">Life</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Miscellaneous/">Miscellaneous</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Performance/">Performance</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Poker/">Poker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server/">SQL Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Community/">SQL Server - Community</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Data Types/">SQL Server - Data Types</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Internals/">SQL Server - Internals</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Optimization/">SQL Server - Optimization</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - OrcaMDF/">SQL Server - OrcaMDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/SQL Server - Tricks/">SQL Server - Tricks</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Testing/">Testing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Tools of the Trade/">Tools of the Trade</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Umbraco/">Umbraco</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Visual Studio/">Visual Studio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Web/">Web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Windbg/">Windbg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/category/Windows/">Windows</a></li></ul>

					
				</div>

				<div class="archive aside">
					<span class="sectiontitle">ARCHIVE</span>
					<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archive/2014">2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2013">2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2012">2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2011">2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2010">2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2009">2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2008">2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2007">2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archive/2006">2006</a></li></ul>
				</div>
			</div>

			<div class="clear"></div>
		</div>
		
		<footer>
			<div class="wrapper">Copyright &copy; 2014 Mark S. Rasmussen</div>
		</footer>

		<script type="text/javascript">
			$(function () {
				// Show mobile menu
				$("li.navicon").click(function () {
					if ($("header ul.mobile a").length == 0) {
						// Pages
						$mobilePages = $("div#naviconcontent ul.pages");
						$("header nav ul.normal > li").not(".navicon").each(function (i, el) {
							$mobilePages.append($(el).clone());
						});

						// Categories
						$mobileCategories = $("div#naviconcontent ul.categories");
						$("div#asides div.categories > ul > li").each(function (i, el) {
							$mobileCategories.append($(el).clone());
						});

						// Archive
						$mobileArchive = $("div#naviconcontent ul.archive");
						$("div#asides div.archive > ul > li").each(function (i, el) {
							$mobileArchive.append($(el).clone());
						});
					};

					$("header ul.mobile").toggle();
				});

				// Fancybox setup
				$("a.fancy").fancybox({
					hideOnContentClick: true,
					overlayShow: true
				});
			});
		</script>
	</body>
</html>